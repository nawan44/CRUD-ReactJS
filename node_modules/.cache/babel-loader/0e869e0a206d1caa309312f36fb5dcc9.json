{"ast":null,"code":"'use strict';\n\nconst url = require('url');\n\nconst path = require('path');\n\nconst retry = require('retry-as-promised');\n\nconst _ = require('lodash');\n\nconst Utils = require('./utils');\n\nconst Model = require('./model');\n\nconst DataTypes = require('./data-types');\n\nconst Deferrable = require('./deferrable');\n\nconst ModelManager = require('./model-manager');\n\nconst Transaction = require('./transaction');\n\nconst QueryTypes = require('./query-types');\n\nconst TableHints = require('./table-hints');\n\nconst IndexHints = require('./index-hints');\n\nconst sequelizeErrors = require('./errors');\n\nconst Hooks = require('./hooks');\n\nconst Association = require('./associations/index');\n\nconst Validator = require('./utils/validator-extras').validator;\n\nconst Op = require('./operators');\n\nconst deprecations = require('./utils/deprecations');\n/**\n * This is the main class, the entry point to sequelize.\n */\n\n\nclass Sequelize {\n  /**\n   * Instantiate sequelize with name of database, username and password.\n   *\n   * @example\n   * // without password / with blank password\n   * const sequelize = new Sequelize('database', 'username', null, {\n   *   dialect: 'mysql'\n   * })\n   *\n   * // with password and options\n   * const sequelize = new Sequelize('my_database', 'john', 'doe', {\n   *   dialect: 'postgres'\n   * })\n   *\n   * // with database, username, and password in the options object\n   * const sequelize = new Sequelize({ database, username, password, dialect: 'mssql' });\n   *\n   * // with uri\n   * const sequelize = new Sequelize('mysql://localhost:3306/database', {})\n   *\n   * // option examples\n   * const sequelize = new Sequelize('database', 'username', 'password', {\n   *   // the sql dialect of the database\n   *   // currently supported: 'mysql', 'sqlite', 'postgres', 'mssql'\n   *   dialect: 'mysql',\n   *\n   *   // custom host; default: localhost\n   *   host: 'my.server.tld',\n   *   // for postgres, you can also specify an absolute path to a directory\n   *   // containing a UNIX socket to connect over\n   *   // host: '/sockets/psql_sockets'.\n   *\n   *   // custom port; default: dialect default\n   *   port: 12345,\n   *\n   *   // custom protocol; default: 'tcp'\n   *   // postgres only, useful for Heroku\n   *   protocol: null,\n   *\n   *   // disable logging or provide a custom logging function; default: console.log\n   *   logging: false,\n   *\n   *   // you can also pass any dialect options to the underlying dialect library\n   *   // - default is empty\n   *   // - currently supported: 'mysql', 'postgres', 'mssql'\n   *   dialectOptions: {\n   *     socketPath: '/Applications/MAMP/tmp/mysql/mysql.sock',\n   *     supportBigNumbers: true,\n   *     bigNumberStrings: true\n   *   },\n   *\n   *   // the storage engine for sqlite\n   *   // - default ':memory:'\n   *   storage: 'path/to/database.sqlite',\n   *\n   *   // disable inserting undefined values as NULL\n   *   // - default: false\n   *   omitNull: true,\n   *\n   *   // a flag for using a native library or not.\n   *   // in the case of 'pg' -- set this to true will allow SSL support\n   *   // - default: false\n   *   native: true,\n   *\n   *   // Specify options, which are used when sequelize.define is called.\n   *   // The following example:\n   *   //   define: { timestamps: false }\n   *   // is basically the same as:\n   *   //   Model.init(attributes, { timestamps: false });\n   *   //   sequelize.define(name, attributes, { timestamps: false });\n   *   // so defining the timestamps for each model will be not necessary\n   *   define: {\n   *     underscored: false,\n   *     freezeTableName: false,\n   *     charset: 'utf8',\n   *     dialectOptions: {\n   *       collate: 'utf8_general_ci'\n   *     },\n   *     timestamps: true\n   *   },\n   *\n   *   // similar for sync: you can define this to always force sync for models\n   *   sync: { force: true },\n   *\n   *   // pool configuration used to pool database connections\n   *   pool: {\n   *     max: 5,\n   *     idle: 30000,\n   *     acquire: 60000,\n   *   },\n   *\n   *   // isolation level of each transaction\n   *   // defaults to dialect default\n   *   isolationLevel: Transaction.ISOLATION_LEVELS.REPEATABLE_READ\n   * })\n   *\n   * @param {string}   [database] The name of the database\n   * @param {string}   [username=null] The username which is used to authenticate against the database.\n   * @param {string}   [password=null] The password which is used to authenticate against the database. Supports SQLCipher encryption for SQLite.\n   * @param {object}   [options={}] An object with options.\n   * @param {string}   [options.host='localhost'] The host of the relational database.\n   * @param {number}   [options.port=] The port of the relational database.\n   * @param {string}   [options.username=null] The username which is used to authenticate against the database.\n   * @param {string}   [options.password=null] The password which is used to authenticate against the database.\n   * @param {string}   [options.database=null] The name of the database\n   * @param {string}   [options.dialect] The dialect of the database you are connecting to. One of mysql, postgres, sqlite and mssql.\n   * @param {string}   [options.dialectModule=null] If specified, use this dialect library. For example, if you want to use pg.js instead of pg when connecting to a pg database, you should specify 'require(\"pg.js\")' here\n   * @param {string}   [options.dialectModulePath=null] If specified, load the dialect library from this path. For example, if you want to use pg.js instead of pg when connecting to a pg database, you should specify '/path/to/pg.js' here\n   * @param {object}   [options.dialectOptions] An object of additional options, which are passed directly to the connection library\n   * @param {string}   [options.storage] Only used by sqlite. Defaults to ':memory:'\n   * @param {string}   [options.protocol='tcp'] The protocol of the relational database.\n   * @param {object}   [options.define={}] Default options for model definitions. See {@link Model.init}.\n   * @param {object}   [options.query={}] Default options for sequelize.query\n   * @param {string}   [options.schema=null] A schema to use\n   * @param {object}   [options.set={}] Default options for sequelize.set\n   * @param {object}   [options.sync={}] Default options for sequelize.sync\n   * @param {string}   [options.timezone='+00:00'] The timezone used when converting a date from the database into a JavaScript date. The timezone is also used to SET TIMEZONE when connecting to the server, to ensure that the result of NOW, CURRENT_TIMESTAMP and other time related functions have in the right timezone. For best cross platform performance use the format +/-HH:MM. Will also accept string versions of timezones used by moment.js (e.g. 'America/Los_Angeles'); this is useful to capture daylight savings time changes.\n   * @param {string|boolean} [options.clientMinMessages='warning'] The PostgreSQL `client_min_messages` session parameter. Set to `false` to not override the database's default.\n   * @param {boolean}  [options.standardConformingStrings=true] The PostgreSQL `standard_conforming_strings` session parameter. Set to `false` to not set the option. WARNING: Setting this to false may expose vulnerabilities and is not recommended!\n   * @param {Function} [options.logging=console.log] A function that gets executed every time Sequelize would log something. Function may receive multiple parameters but only first one is printed by `console.log`. To print all values use `(...msg) => console.log(msg)`\n   * @param {boolean}  [options.benchmark=false] Pass query execution time in milliseconds as second argument to logging function (options.logging).\n   * @param {boolean}  [options.omitNull=false] A flag that defines if null values should be passed as values to CREATE/UPDATE SQL queries or not.\n   * @param {boolean}  [options.native=false] A flag that defines if native library shall be used or not. Currently only has an effect for postgres\n   * @param {boolean}  [options.replication=false] Use read / write replication. To enable replication, pass an object, with two properties, read and write. Write should be an object (a single server for handling writes), and read an array of object (several servers to handle reads). Each read/write server can have the following properties: `host`, `port`, `username`, `password`, `database`\n   * @param {object}   [options.pool] sequelize connection pool configuration\n   * @param {number}   [options.pool.max=5] Maximum number of connection in pool\n   * @param {number}   [options.pool.min=0] Minimum number of connection in pool\n   * @param {number}   [options.pool.idle=10000] The maximum time, in milliseconds, that a connection can be idle before being released.\n   * @param {number}   [options.pool.acquire=60000] The maximum time, in milliseconds, that pool will try to get connection before throwing error\n   * @param {number}   [options.pool.evict=1000] The time interval, in milliseconds, after which sequelize-pool will remove idle connections.\n   * @param {Function} [options.pool.validate] A function that validates a connection. Called with client. The default function checks that client is an object, and that its state is not disconnected\n   * @param {number}   [options.pool.maxUses=Infinity] The number of times a connection can be used before discarding it for a replacement, [`used for eventual cluster rebalancing`](https://github.com/sequelize/sequelize-pool).\n   * @param {boolean}  [options.quoteIdentifiers=true] Set to `false` to make table names and attributes case-insensitive on Postgres and skip double quoting of them.  WARNING: Setting this to false may expose vulnerabilities and is not recommended!\n   * @param {string}   [options.transactionType='DEFERRED'] Set the default transaction type. See `Sequelize.Transaction.TYPES` for possible options. Sqlite only.\n   * @param {string}   [options.isolationLevel] Set the default transaction isolation level. See `Sequelize.Transaction.ISOLATION_LEVELS` for possible options.\n   * @param {object}   [options.retry] Set of flags that control when a query is automatically retried. Accepts all options for [`retry-as-promised`](https://github.com/mickhansen/retry-as-promised).\n   * @param {Array}    [options.retry.match] Only retry a query if the error matches one of these strings.\n   * @param {number}   [options.retry.max] How many times a failing query is automatically retried.  Set to 0 to disable retrying on SQL_BUSY error.\n   * @param {boolean}  [options.typeValidation=false] Run built-in type validators on insert and update, and select with where clause, e.g. validate that arguments passed to integer fields are integer-like.\n   * @param {object}   [options.operatorsAliases] String based operator alias. Pass object to limit set of aliased operators.\n   * @param {object}   [options.hooks] An object of global hook functions that are called before and after certain lifecycle events. Global hooks will run after any model-specific hooks defined for the same event (See `Sequelize.Model.init()` for a list).  Additionally, `beforeConnect()`, `afterConnect()`, `beforeDisconnect()`, and `afterDisconnect()` hooks may be defined here.\n   * @param {boolean}  [options.minifyAliases=false] A flag that defines if aliases should be minified (mostly useful to avoid Postgres alias character limit of 64)\n   * @param {boolean}  [options.logQueryParameters=false] A flag that defines if show bind patameters in log.\n   */\n  constructor(database, username, password, options) {\n    let config;\n\n    if (arguments.length === 1 && typeof database === 'object') {\n      // new Sequelize({ ... options })\n      options = database;\n      config = _.pick(options, 'host', 'port', 'database', 'username', 'password');\n    } else if (arguments.length === 1 && typeof database === 'string' || arguments.length === 2 && typeof username === 'object') {\n      // new Sequelize(URI, { ... options })\n      config = {};\n      options = username || {};\n      const urlParts = url.parse(arguments[0], true);\n      options.dialect = urlParts.protocol.replace(/:$/, '');\n      options.host = urlParts.hostname;\n\n      if (options.dialect === 'sqlite' && urlParts.pathname && !urlParts.pathname.startsWith('/:memory')) {\n        const storagePath = path.join(options.host, urlParts.pathname);\n        options.storage = path.resolve(options.storage || storagePath);\n      }\n\n      if (urlParts.pathname) {\n        config.database = urlParts.pathname.replace(/^\\//, '');\n      }\n\n      if (urlParts.port) {\n        options.port = urlParts.port;\n      }\n\n      if (urlParts.auth) {\n        const authParts = urlParts.auth.split(':');\n        config.username = authParts[0];\n        if (authParts.length > 1) config.password = authParts.slice(1).join(':');\n      }\n\n      if (urlParts.query) {\n        // Allow host query argument to override the url host.\n        // Enables specifying domain socket hosts which cannot be specified via the typical\n        // host part of a url.\n        if (urlParts.query.host) {\n          options.host = urlParts.query.host;\n        }\n\n        if (options.dialectOptions) {\n          Object.assign(options.dialectOptions, urlParts.query);\n        } else {\n          options.dialectOptions = urlParts.query;\n\n          if (urlParts.query.options) {\n            try {\n              const o = JSON.parse(urlParts.query.options);\n              options.dialectOptions.options = o;\n            } catch (e) {// Nothing to do, string is not a valid JSON\n              // an thus does not need any further processing\n            }\n          }\n        }\n      }\n    } else {\n      // new Sequelize(database, username, password, { ... options })\n      options = options || {};\n      config = {\n        database,\n        username,\n        password\n      };\n    }\n\n    Sequelize.runHooks('beforeInit', config, options);\n    this.options = {\n      dialect: null,\n      dialectModule: null,\n      dialectModulePath: null,\n      host: 'localhost',\n      protocol: 'tcp',\n      define: {},\n      query: {},\n      sync: {},\n      timezone: '+00:00',\n      clientMinMessages: 'warning',\n      standardConformingStrings: true,\n      // eslint-disable-next-line no-console\n      logging: console.log,\n      omitNull: false,\n      native: false,\n      replication: false,\n      ssl: undefined,\n      pool: {},\n      quoteIdentifiers: true,\n      hooks: {},\n      retry: {\n        max: 5,\n        match: ['SQLITE_BUSY: database is locked']\n      },\n      transactionType: Transaction.TYPES.DEFERRED,\n      isolationLevel: null,\n      databaseVersion: 0,\n      typeValidation: false,\n      benchmark: false,\n      minifyAliases: false,\n      logQueryParameters: false,\n      ...options\n    };\n\n    if (!this.options.dialect) {\n      throw new Error('Dialect needs to be explicitly supplied as of v4.0.0');\n    }\n\n    if (this.options.dialect === 'postgresql') {\n      this.options.dialect = 'postgres';\n    }\n\n    if (this.options.dialect === 'sqlite' && this.options.timezone !== '+00:00') {\n      throw new Error('Setting a custom timezone is not supported by SQLite, dates are always returned as UTC. Please remove the custom timezone parameter.');\n    }\n\n    if (this.options.logging === true) {\n      deprecations.noTrueLogging(); // eslint-disable-next-line no-console\n\n      this.options.logging = console.log;\n    }\n\n    this._setupHooks(options.hooks);\n\n    this.config = {\n      database: config.database || this.options.database,\n      username: config.username || this.options.username,\n      password: config.password || this.options.password || null,\n      host: config.host || this.options.host,\n      port: config.port || this.options.port,\n      pool: this.options.pool,\n      protocol: this.options.protocol,\n      native: this.options.native,\n      ssl: this.options.ssl,\n      replication: this.options.replication,\n      dialectModule: this.options.dialectModule,\n      dialectModulePath: this.options.dialectModulePath,\n      keepDefaultTimezone: this.options.keepDefaultTimezone,\n      dialectOptions: this.options.dialectOptions\n    };\n    let Dialect; // Requiring the dialect in a switch-case to keep the\n    // require calls static. (Browserify fix)\n\n    switch (this.getDialect()) {\n      case 'mariadb':\n        Dialect = require('./dialects/mariadb');\n        break;\n\n      case 'mssql':\n        Dialect = require('./dialects/mssql');\n        break;\n\n      case 'mysql':\n        Dialect = require('./dialects/mysql');\n        break;\n\n      case 'postgres':\n        Dialect = require('./dialects/postgres');\n        break;\n\n      case 'sqlite':\n        Dialect = require('./dialects/sqlite');\n        break;\n\n      default:\n        throw new Error(`The dialect ${this.getDialect()} is not supported. Supported dialects: mssql, mariadb, mysql, postgres, and sqlite.`);\n    }\n\n    this.dialect = new Dialect(this);\n    this.dialect.queryGenerator.typeValidation = options.typeValidation;\n\n    if (_.isPlainObject(this.options.operatorsAliases)) {\n      deprecations.noStringOperators();\n      this.dialect.queryGenerator.setOperatorsAliases(this.options.operatorsAliases);\n    } else if (typeof this.options.operatorsAliases === 'boolean') {\n      deprecations.noBoolOperatorAliases();\n    }\n\n    this.queryInterface = this.dialect.queryInterface;\n    /**\n     * Models are stored here under the name given to `sequelize.define`\n     */\n\n    this.models = {};\n    this.modelManager = new ModelManager(this);\n    this.connectionManager = this.dialect.connectionManager;\n    Sequelize.runHooks('afterInit', this);\n  }\n  /**\n   * Refresh data types and parsers.\n   *\n   * @private\n   */\n\n\n  refreshTypes() {\n    this.connectionManager.refreshTypeParser(DataTypes);\n  }\n  /**\n   * Returns the specified dialect.\n   *\n   * @returns {string} The specified dialect.\n   */\n\n\n  getDialect() {\n    return this.options.dialect;\n  }\n  /**\n   * Returns the database name.\n   *\n   * @returns {string} The database name.\n   */\n\n\n  getDatabaseName() {\n    return this.config.database;\n  }\n  /**\n   * Returns an instance of QueryInterface.\n   *\n   * @returns {QueryInterface} An instance (singleton) of QueryInterface.\n   */\n\n\n  getQueryInterface() {\n    return this.queryInterface;\n  }\n  /**\n   * Define a new model, representing a table in the database.\n   *\n   * The table columns are defined by the object that is given as the second argument. Each key of the object represents a column\n   *\n   * @param {string} modelName The name of the model. The model will be stored in `sequelize.models` under this name\n   * @param {object} attributes An object, where each attribute is a column of the table. See {@link Model.init}\n   * @param {object} [options] These options are merged with the default define options provided to the Sequelize constructor and passed to Model.init()\n   *\n   * @see\n   * {@link Model.init} for a more comprehensive specification of the `options` and `attributes` objects.\n   * @see\n   * <a href=\"/master/manual/model-basics.html\">Model Basics</a> guide\n   *\n   * @returns {Model} Newly defined model\n   *\n   * @example\n   * sequelize.define('modelName', {\n   *   columnA: {\n   *       type: Sequelize.BOOLEAN,\n   *       validate: {\n   *         is: [\"[a-z]\",'i'],        // will only allow letters\n   *         max: 23,                  // only allow values <= 23\n   *         isIn: {\n   *           args: [['en', 'zh']],\n   *           msg: \"Must be English or Chinese\"\n   *         }\n   *       },\n   *       field: 'column_a'\n   *   },\n   *   columnB: Sequelize.STRING,\n   *   columnC: 'MY VERY OWN COLUMN TYPE'\n   * });\n   *\n   * sequelize.models.modelName // The model will now be available in models under the name given to define\n   */\n\n\n  define(modelName, attributes, options = {}) {\n    options.modelName = modelName;\n    options.sequelize = this;\n    const model = class extends Model {};\n    model.init(attributes, options);\n    return model;\n  }\n  /**\n   * Fetch a Model which is already defined\n   *\n   * @param {string} modelName The name of a model defined with Sequelize.define\n   *\n   * @throws Will throw an error if the model is not defined (that is, if sequelize#isDefined returns false)\n   * @returns {Model} Specified model\n   */\n\n\n  model(modelName) {\n    if (!this.isDefined(modelName)) {\n      throw new Error(`${modelName} has not been defined`);\n    }\n\n    return this.modelManager.getModel(modelName);\n  }\n  /**\n   * Checks whether a model with the given name is defined\n   *\n   * @param {string} modelName The name of a model defined with Sequelize.define\n   *\n   * @returns {boolean} Returns true if model is already defined, otherwise false\n   */\n\n\n  isDefined(modelName) {\n    return !!this.modelManager.models.find(model => model.name === modelName);\n  }\n  /**\n   * Execute a query on the DB, optionally bypassing all the Sequelize goodness.\n   *\n   * By default, the function will return two arguments: an array of results, and a metadata object, containing number of affected rows etc.\n   *\n   * If you are running a type of query where you don't need the metadata, for example a `SELECT` query, you can pass in a query type to make sequelize format the results:\n   *\n   * ```js\n   * const [results, metadata] = await sequelize.query('SELECT...'); // Raw query - use array destructuring\n   *\n   * const results = await sequelize.query('SELECT...', { type: sequelize.QueryTypes.SELECT }); // SELECT query - no destructuring\n   * ```\n   *\n   * @param {string}          sql\n   * @param {object}          [options={}] Query options.\n   * @param {boolean}         [options.raw] If true, sequelize will not try to format the results of the query, or build an instance of a model from the result\n   * @param {Transaction}     [options.transaction=null] The transaction that the query should be executed under\n   * @param {QueryTypes}      [options.type='RAW'] The type of query you are executing. The query type affects how results are formatted before they are passed back. The type is a string, but `Sequelize.QueryTypes` is provided as convenience shortcuts.\n   * @param {boolean}         [options.nest=false] If true, transforms objects with `.` separated property names into nested objects using [dottie.js](https://github.com/mickhansen/dottie.js). For example { 'user.username': 'john' } becomes { user: { username: 'john' }}. When `nest` is true, the query type is assumed to be `'SELECT'`, unless otherwise specified\n   * @param {boolean}         [options.plain=false] Sets the query type to `SELECT` and return a single row\n   * @param {object|Array}    [options.replacements] Either an object of named parameter replacements in the format `:param` or an array of unnamed replacements to replace `?` in your SQL.\n   * @param {object|Array}    [options.bind] Either an object of named bind parameter in the format `_param` or an array of unnamed bind parameter to replace `$1, $2, ...` in your SQL.\n   * @param {boolean}         [options.useMaster=false] Force the query to use the write pool, regardless of the query type.\n   * @param {Function}        [options.logging=false] A function that gets executed while running the query to log the sql.\n   * @param {Model}           [options.instance] A sequelize model instance whose Model is to be used to build the query result\n   * @param {typeof Model}    [options.model] A sequelize model used to build the returned model instances\n   * @param {object}          [options.retry] Set of flags that control when a query is automatically retried. Accepts all options for [`retry-as-promised`](https://github.com/mickhansen/retry-as-promised).\n   * @param {Array}           [options.retry.match] Only retry a query if the error matches one of these strings.\n   * @param {Integer}         [options.retry.max] How many times a failing query is automatically retried.\n   * @param {string}          [options.searchPath=DEFAULT] An optional parameter to specify the schema search_path (Postgres only)\n   * @param {boolean}         [options.supportsSearchPath] If false do not prepend the query with the search_path (Postgres only)\n   * @param {boolean}         [options.mapToModel=false] Map returned fields to model's fields if `options.model` or `options.instance` is present. Mapping will occur before building the model instance.\n   * @param {object}          [options.fieldMap] Map returned fields to arbitrary names for `SELECT` query type.\n   *\n   * @returns {Promise}\n   *\n   * @see {@link Model.build} for more information about instance option.\n   */\n\n\n  async query(sql, options) {\n    options = { ...this.options.query,\n      ...options\n    };\n\n    if (options.instance && !options.model) {\n      options.model = options.instance.constructor;\n    }\n\n    if (!options.instance && !options.model) {\n      options.raw = true;\n    } // map raw fields to model attributes\n\n\n    if (options.mapToModel) {\n      options.fieldMap = _.get(options, 'model.fieldAttributeMap', {});\n    }\n\n    options = _.defaults(options, {\n      // eslint-disable-next-line no-console\n      logging: Object.prototype.hasOwnProperty.call(this.options, 'logging') ? this.options.logging : console.log,\n      searchPath: Object.prototype.hasOwnProperty.call(this.options, 'searchPath') ? this.options.searchPath : 'DEFAULT'\n    });\n\n    if (!options.type) {\n      if (options.model || options.nest || options.plain) {\n        options.type = QueryTypes.SELECT;\n      } else {\n        options.type = QueryTypes.RAW;\n      }\n    } //if dialect doesn't support search_path or dialect option\n    //to prepend searchPath is not true delete the searchPath option\n\n\n    if (!this.dialect.supports.searchPath || !this.options.dialectOptions || !this.options.dialectOptions.prependSearchPath || options.supportsSearchPath === false) {\n      delete options.searchPath;\n    } else if (!options.searchPath) {\n      //if user wants to always prepend searchPath (dialectOptions.preprendSearchPath = true)\n      //then set to DEFAULT if none is provided\n      options.searchPath = 'DEFAULT';\n    }\n\n    if (typeof sql === 'object') {\n      if (sql.values !== undefined) {\n        if (options.replacements !== undefined) {\n          throw new Error('Both `sql.values` and `options.replacements` cannot be set at the same time');\n        }\n\n        options.replacements = sql.values;\n      }\n\n      if (sql.bind !== undefined) {\n        if (options.bind !== undefined) {\n          throw new Error('Both `sql.bind` and `options.bind` cannot be set at the same time');\n        }\n\n        options.bind = sql.bind;\n      }\n\n      if (sql.query !== undefined) {\n        sql = sql.query;\n      }\n    }\n\n    sql = sql.trim();\n\n    if (options.replacements && options.bind) {\n      throw new Error('Both `replacements` and `bind` cannot be set at the same time');\n    }\n\n    if (options.replacements) {\n      if (Array.isArray(options.replacements)) {\n        sql = Utils.format([sql].concat(options.replacements), this.options.dialect);\n      } else {\n        sql = Utils.formatNamedParameters(sql, options.replacements, this.options.dialect);\n      }\n    }\n\n    let bindParameters;\n\n    if (options.bind) {\n      [sql, bindParameters] = this.dialect.Query.formatBindParameters(sql, options.bind, this.options.dialect);\n    }\n\n    const checkTransaction = () => {\n      if (options.transaction && options.transaction.finished && !options.completesTransaction) {\n        const error = new Error(`${options.transaction.finished} has been called on this transaction(${options.transaction.id}), you can no longer use it. (The rejected query is attached as the 'sql' property of this error)`);\n        error.sql = sql;\n        throw error;\n      }\n    };\n\n    const retryOptions = { ...this.options.retry,\n      ...options.retry\n    };\n    return retry(async () => {\n      if (options.transaction === undefined && Sequelize._cls) {\n        options.transaction = Sequelize._cls.get('transaction');\n      }\n\n      checkTransaction();\n      const connection = await (options.transaction ? options.transaction.connection : this.connectionManager.getConnection(options));\n      const query = new this.dialect.Query(connection, this, options);\n\n      try {\n        await this.runHooks('beforeQuery', options, query);\n        checkTransaction();\n        return await query.run(sql, bindParameters);\n      } finally {\n        await this.runHooks('afterQuery', options, query);\n\n        if (!options.transaction) {\n          await this.connectionManager.releaseConnection(connection);\n        }\n      }\n    }, retryOptions);\n  }\n  /**\n   * Execute a query which would set an environment or user variable. The variables are set per connection, so this function needs a transaction.\n   * Only works for MySQL.\n   *\n   * @param {object}        variables Object with multiple variables.\n   * @param {object}        [options] query options.\n   * @param {Transaction}   [options.transaction] The transaction that the query should be executed under\n   *\n   * @memberof Sequelize\n   *\n   * @returns {Promise}\n   */\n\n\n  async set(variables, options) {\n    // Prepare options\n    options = { ...this.options.set,\n      ...(typeof options === 'object' && options)\n    };\n\n    if (this.options.dialect !== 'mysql') {\n      throw new Error('sequelize.set is only supported for mysql');\n    }\n\n    if (!options.transaction || !(options.transaction instanceof Transaction)) {\n      throw new TypeError('options.transaction is required');\n    } // Override some options, since this isn't a SELECT\n\n\n    options.raw = true;\n    options.plain = true;\n    options.type = 'SET'; // Generate SQL Query\n\n    const query = `SET ${_.map(variables, (v, k) => `@${k} := ${typeof v === 'string' ? `\"${v}\"` : v}`).join(', ')}`;\n    return await this.query(query, options);\n  }\n  /**\n   * Escape value.\n   *\n   * @param {string} value string value to escape\n   *\n   * @returns {string}\n   */\n\n\n  escape(value) {\n    return this.dialect.queryGenerator.escape(value);\n  }\n  /**\n   * Create a new database schema.\n   *\n   * **Note:** this is a schema in the [postgres sense of the word](http://www.postgresql.org/docs/9.1/static/ddl-schemas.html),\n   * not a database table. In mysql and sqlite, this command will do nothing.\n   *\n   * @see\n   * {@link Model.schema}\n   *\n   * @param {string} schema Name of the schema\n   * @param {object} [options={}] query options\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n\n\n  async createSchema(schema, options) {\n    return await this.getQueryInterface().createSchema(schema, options);\n  }\n  /**\n   * Show all defined schemas\n   *\n   * **Note:** this is a schema in the [postgres sense of the word](http://www.postgresql.org/docs/9.1/static/ddl-schemas.html),\n   * not a database table. In mysql and sqlite, this will show all tables.\n   *\n   * @param {object} [options={}] query options\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n\n\n  async showAllSchemas(options) {\n    return await this.getQueryInterface().showAllSchemas(options);\n  }\n  /**\n   * Drop a single schema\n   *\n   * **Note:** this is a schema in the [postgres sense of the word](http://www.postgresql.org/docs/9.1/static/ddl-schemas.html),\n   * not a database table. In mysql and sqlite, this drop a table matching the schema name\n   *\n   * @param {string} schema Name of the schema\n   * @param {object} [options={}] query options\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n\n\n  async dropSchema(schema, options) {\n    return await this.getQueryInterface().dropSchema(schema, options);\n  }\n  /**\n   * Drop all schemas.\n   *\n   * **Note:** this is a schema in the [postgres sense of the word](http://www.postgresql.org/docs/9.1/static/ddl-schemas.html),\n   * not a database table. In mysql and sqlite, this is the equivalent of drop all tables.\n   *\n   * @param {object} [options={}] query options\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n\n\n  async dropAllSchemas(options) {\n    return await this.getQueryInterface().dropAllSchemas(options);\n  }\n  /**\n   * Sync all defined models to the DB.\n   *\n   * @param {object} [options={}] sync options\n   * @param {boolean} [options.force=false] If force is true, each Model will run `DROP TABLE IF EXISTS`, before it tries to create its own table\n   * @param {RegExp} [options.match] Match a regex against the database name before syncing, a safety check for cases where force: true is used in tests but not live code\n   * @param {boolean|Function} [options.logging=console.log] A function that logs sql queries, or false for no logging\n   * @param {string} [options.schema='public'] The schema that the tables should be created in. This can be overridden for each table in sequelize.define\n   * @param {string} [options.searchPath=DEFAULT] An optional parameter to specify the schema search_path (Postgres only)\n   * @param {boolean} [options.hooks=true] If hooks is true then beforeSync, afterSync, beforeBulkSync, afterBulkSync hooks will be called\n   * @param {boolean|object} [options.alter=false] Alters tables to fit models. Provide an object for additional configuration. Not recommended for production use. If not further configured deletes data in columns that were removed or had their type changed in the model.\n   * @param {boolean} [options.alter.drop=true] Prevents any drop statements while altering a table when set to `false`\n   *\n   * @returns {Promise}\n   */\n\n\n  async sync(options) {\n    options = { ...this.options,\n      ...this.options.sync,\n      ...options,\n      hooks: options ? options.hooks !== false : true\n    };\n\n    if (options.match) {\n      if (!options.match.test(this.config.database)) {\n        throw new Error(`Database \"${this.config.database}\" does not match sync match parameter \"${options.match}\"`);\n      }\n    }\n\n    if (options.hooks) {\n      await this.runHooks('beforeBulkSync', options);\n    }\n\n    if (options.force) {\n      await this.drop(options);\n    }\n\n    const models = []; // Topologically sort by foreign key constraints to give us an appropriate\n    // creation order\n\n    this.modelManager.forEachModel(model => {\n      if (model) {\n        models.push(model);\n      } else {// DB should throw an SQL error if referencing non-existent table\n      }\n    }); // no models defined, just authenticate\n\n    if (!models.length) {\n      await this.authenticate(options);\n    } else {\n      for (const model of models) await model.sync(options);\n    }\n\n    if (options.hooks) {\n      await this.runHooks('afterBulkSync', options);\n    }\n\n    return this;\n  }\n  /**\n   * Truncate all tables defined through the sequelize models.\n   * This is done by calling `Model.truncate()` on each model.\n   *\n   * @param {object} [options] The options passed to Model.destroy in addition to truncate\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   * @returns {Promise}\n   *\n   * @see\n   * {@link Model.truncate} for more information\n   */\n\n\n  async truncate(options) {\n    const models = [];\n    this.modelManager.forEachModel(model => {\n      if (model) {\n        models.push(model);\n      }\n    }, {\n      reverse: false\n    });\n\n    if (options && options.cascade) {\n      for (const model of models) await model.truncate(options);\n    } else {\n      await Promise.all(models.map(model => model.truncate(options)));\n    }\n  }\n  /**\n   * Drop all tables defined through this sequelize instance.\n   * This is done by calling Model.drop on each model.\n   *\n   * @see\n   * {@link Model.drop} for options\n   *\n   * @param {object} [options] The options passed to each call to Model.drop\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n\n\n  async drop(options) {\n    const models = [];\n    this.modelManager.forEachModel(model => {\n      if (model) {\n        models.push(model);\n      }\n    }, {\n      reverse: false\n    });\n\n    for (const model of models) await model.drop(options);\n  }\n  /**\n   * Test the connection by trying to authenticate. It runs `SELECT 1+1 AS result` query.\n   *\n   * @param {object} [options={}] query options\n   *\n   * @returns {Promise}\n   */\n\n\n  async authenticate(options) {\n    options = {\n      raw: true,\n      plain: true,\n      type: QueryTypes.SELECT,\n      ...options\n    };\n    await this.query('SELECT 1+1 AS result', options);\n    return;\n  }\n\n  async databaseVersion(options) {\n    return await this.getQueryInterface().databaseVersion(options);\n  }\n  /**\n   * Get the fn for random based on the dialect\n   *\n   * @returns {Sequelize.fn}\n   */\n\n\n  random() {\n    const dia = this.getDialect();\n\n    if (dia === 'postgres' || dia === 'sqlite') {\n      return this.fn('RANDOM');\n    }\n\n    return this.fn('RAND');\n  }\n  /**\n   * Creates an object representing a database function. This can be used in search queries, both in where and order parts, and as default values in column definitions.\n   * If you want to refer to columns in your function, you should use `sequelize.col`, so that the columns are properly interpreted as columns and not a strings.\n   *\n   * @see\n   * {@link Model.findAll}\n   * @see\n   * {@link Sequelize.define}\n   * @see\n   * {@link Sequelize.col}\n   *\n   * @param {string} fn The function you want to call\n   * @param {any} args All further arguments will be passed as arguments to the function\n   *\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   * @returns {Sequelize.fn}\n   *\n   * @example <caption>Convert a user's username to upper case</caption>\n   * instance.update({\n   *   username: sequelize.fn('upper', sequelize.col('username'))\n   * });\n   */\n\n\n  static fn(fn, ...args) {\n    return new Utils.Fn(fn, args);\n  }\n  /**\n   * Creates an object which represents a column in the DB, this allows referencing another column in your query. This is often useful in conjunction with `sequelize.fn`, since raw string arguments to fn will be escaped.\n   *\n   * @see\n   * {@link Sequelize#fn}\n   *\n   * @param {string} col The name of the column\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.col}\n   */\n\n\n  static col(col) {\n    return new Utils.Col(col);\n  }\n  /**\n   * Creates an object representing a call to the cast function.\n   *\n   * @param {any} val The value to cast\n   * @param {string} type The type to cast it to\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.cast}\n   */\n\n\n  static cast(val, type) {\n    return new Utils.Cast(val, type);\n  }\n  /**\n   * Creates an object representing a literal, i.e. something that will not be escaped.\n   *\n   * @param {any} val literal value\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.literal}\n   */\n\n\n  static literal(val) {\n    return new Utils.Literal(val);\n  }\n  /**\n   * An AND query\n   *\n   * @see\n   * {@link Model.findAll}\n   *\n   * @param {...string|object} args Each argument will be joined by AND\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.and}\n   */\n\n\n  static and(...args) {\n    return {\n      [Op.and]: args\n    };\n  }\n  /**\n   * An OR query\n   *\n   * @see\n   * {@link Model.findAll}\n   *\n   * @param {...string|object} args Each argument will be joined by OR\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.or}\n   */\n\n\n  static or(...args) {\n    return {\n      [Op.or]: args\n    };\n  }\n  /**\n   * Creates an object representing nested where conditions for postgres/sqlite/mysql json data-type.\n   *\n   * @see\n   * {@link Model.findAll}\n   *\n   * @param {string|object} conditionsOrPath A hash containing strings/numbers or other nested hash, a string using dot notation or a string using postgres/sqlite/mysql json syntax.\n   * @param {string|number|boolean} [value] An optional value to compare against. Produces a string of the form \"<json path> = '<value>'\".\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.json}\n   */\n\n\n  static json(conditionsOrPath, value) {\n    return new Utils.Json(conditionsOrPath, value);\n  }\n  /**\n   * A way of specifying attr = condition.\n   *\n   * The attr can either be an object taken from `Model.rawAttributes` (for example `Model.rawAttributes.id` or `Model.rawAttributes.name`). The\n   * attribute should be defined in your model definition. The attribute can also be an object from one of the sequelize utility functions (`sequelize.fn`, `sequelize.col` etc.)\n   *\n   * For string attributes, use the regular `{ where: { attr: something }}` syntax. If you don't want your string to be escaped, use `sequelize.literal`.\n   *\n   * @see\n   * {@link Model.findAll}\n   *\n   * @param {object} attr The attribute, which can be either an attribute object from `Model.rawAttributes` or a sequelize object, for example an instance of `sequelize.fn`. For simple string attributes, use the POJO syntax\n   * @param {symbol} [comparator='Op.eq'] operator\n   * @param {string|object} logic The condition. Can be both a simply type, or a further condition (`or`, `and`, `.literal` etc.)\n   * @since v2.0.0-dev3\n   */\n\n\n  static where(attr, comparator, logic) {\n    return new Utils.Where(attr, comparator, logic);\n  }\n  /**\n   * Start a transaction. When using transactions, you should pass the transaction in the options argument in order for the query to happen under that transaction @see {@link Transaction}\n   *\n   * If you have [CLS](https://github.com/Jeff-Lewis/cls-hooked) enabled, the transaction will automatically be passed to any query that runs within the callback\n   *\n   * @example\n   *\n   * try {\n   *   const transaction = await sequelize.transaction();\n   *   const user = await User.findOne(..., { transaction });\n   *   await user.update(..., { transaction });\n   *   await transaction.commit();\n   * } catch {\n   *   await transaction.rollback()\n   * }\n   *\n   * @example <caption>A syntax for automatically committing or rolling back based on the promise chain resolution is also supported</caption>\n   *\n   * try {\n   *   await sequelize.transaction(transaction => { // Note that we pass a callback rather than awaiting the call with no arguments\n   *     const user = await User.findOne(..., {transaction});\n   *     await user.update(..., {transaction});\n   *   });\n   *   // Committed\n   * } catch(err) {\n   *   // Rolled back\n   *   console.error(err);\n   * }\n   * @example <caption>To enable CLS, add it do your project, create a namespace and set it on the sequelize constructor:</caption>\n   *\n   * const cls = require('cls-hooked');\n   * const namespace = cls.createNamespace('....');\n   * const Sequelize = require('sequelize');\n   * Sequelize.useCLS(namespace);\n   *\n   * // Note, that CLS is enabled for all sequelize instances, and all instances will share the same namespace\n   *\n   * @param {object}   [options] Transaction options\n   * @param {string}   [options.type='DEFERRED'] See `Sequelize.Transaction.TYPES` for possible options. Sqlite only.\n   * @param {string}   [options.isolationLevel] See `Sequelize.Transaction.ISOLATION_LEVELS` for possible options\n   * @param {string}   [options.deferrable] Sets the constraints to be deferred or immediately checked. See `Sequelize.Deferrable`. PostgreSQL Only\n   * @param {Function} [options.logging=false] A function that gets executed while running the query to log the sql.\n   * @param {Function} [autoCallback] The callback is called with the transaction object, and should return a promise. If the promise is resolved, the transaction commits; if the promise rejects, the transaction rolls back\n   *\n   * @returns {Promise}\n   */\n\n\n  async transaction(options, autoCallback) {\n    if (typeof options === 'function') {\n      autoCallback = options;\n      options = undefined;\n    }\n\n    const transaction = new Transaction(this, options);\n\n    if (!autoCallback) {\n      await transaction.prepareEnvironment(false);\n      return transaction;\n    } // autoCallback provided\n\n\n    return Sequelize._clsRun(async () => {\n      try {\n        await transaction.prepareEnvironment();\n        const result = await autoCallback(transaction);\n        await transaction.commit();\n        return await result;\n      } catch (err) {\n        if (!transaction.finished) {\n          try {\n            await transaction.rollback();\n          } catch (err0) {// ignore\n          }\n        }\n\n        throw err;\n      }\n    });\n  }\n  /**\n   * Use CLS with Sequelize.\n   * CLS namespace provided is stored as `Sequelize._cls`\n   *\n   * @param {object} ns CLS namespace\n   * @returns {object} Sequelize constructor\n   */\n\n\n  static useCLS(ns) {\n    // check `ns` is valid CLS namespace\n    if (!ns || typeof ns !== 'object' || typeof ns.bind !== 'function' || typeof ns.run !== 'function') throw new Error('Must provide CLS namespace'); // save namespace as `Sequelize._cls`\n\n    this._cls = ns; // return Sequelize for chaining\n\n    return this;\n  }\n  /**\n   * Run function in CLS context.\n   * If no CLS context in use, just runs the function normally\n   *\n   * @private\n   * @param {Function} fn Function to run\n   * @returns {*} Return value of function\n   */\n\n\n  static _clsRun(fn) {\n    const ns = Sequelize._cls;\n    if (!ns) return fn();\n    let res;\n    ns.run(context => res = fn(context));\n    return res;\n  }\n\n  log(...args) {\n    let options;\n\n    const last = _.last(args);\n\n    if (last && _.isPlainObject(last) && Object.prototype.hasOwnProperty.call(last, 'logging')) {\n      options = last; // remove options from set of logged arguments if options.logging is equal to console.log\n      // eslint-disable-next-line no-console\n\n      if (options.logging === console.log) {\n        args.splice(args.length - 1, 1);\n      }\n    } else {\n      options = this.options;\n    }\n\n    if (options.logging) {\n      if (options.logging === true) {\n        deprecations.noTrueLogging(); // eslint-disable-next-line no-console\n\n        options.logging = console.log;\n      } // second argument is sql-timings, when benchmarking option enabled\n      // eslint-disable-next-line no-console\n\n\n      if ((this.options.benchmark || options.benchmark) && options.logging === console.log) {\n        args = [`${args[0]} Elapsed time: ${args[1]}ms`];\n      }\n\n      options.logging(...args);\n    }\n  }\n  /**\n   * Close all connections used by this sequelize instance, and free all references so the instance can be garbage collected.\n   *\n   * Normally this is done on process exit, so you only need to call this method if you are creating multiple instances, and want\n   * to garbage collect some of them.\n   *\n   * @returns {Promise}\n   */\n\n\n  close() {\n    return this.connectionManager.close();\n  }\n\n  normalizeDataType(Type) {\n    let type = typeof Type === 'function' ? new Type() : Type;\n    const dialectTypes = this.dialect.DataTypes || {};\n\n    if (dialectTypes[type.key]) {\n      type = dialectTypes[type.key].extend(type);\n    }\n\n    if (type instanceof DataTypes.ARRAY) {\n      if (!type.type) {\n        throw new Error('ARRAY is missing type definition for its values.');\n      }\n\n      if (dialectTypes[type.type.key]) {\n        type.type = dialectTypes[type.type.key].extend(type.type);\n      }\n    }\n\n    return type;\n  }\n\n  normalizeAttribute(attribute) {\n    if (!_.isPlainObject(attribute)) {\n      attribute = {\n        type: attribute\n      };\n    }\n\n    if (!attribute.type) return attribute;\n    attribute.type = this.normalizeDataType(attribute.type);\n\n    if (Object.prototype.hasOwnProperty.call(attribute, 'defaultValue')) {\n      if (typeof attribute.defaultValue === 'function' && (attribute.defaultValue === DataTypes.NOW || attribute.defaultValue === DataTypes.UUIDV1 || attribute.defaultValue === DataTypes.UUIDV4)) {\n        attribute.defaultValue = new attribute.defaultValue();\n      }\n    }\n\n    if (attribute.type instanceof DataTypes.ENUM) {\n      // The ENUM is a special case where the type is an object containing the values\n      if (attribute.values) {\n        attribute.type.values = attribute.type.options.values = attribute.values;\n      } else {\n        attribute.values = attribute.type.values;\n      }\n\n      if (!attribute.values.length) {\n        throw new Error('Values for ENUM have not been defined.');\n      }\n    }\n\n    return attribute;\n  }\n\n} // Aliases\n\n\nSequelize.prototype.fn = Sequelize.fn;\nSequelize.prototype.col = Sequelize.col;\nSequelize.prototype.cast = Sequelize.cast;\nSequelize.prototype.literal = Sequelize.literal;\nSequelize.prototype.and = Sequelize.and;\nSequelize.prototype.or = Sequelize.or;\nSequelize.prototype.json = Sequelize.json;\nSequelize.prototype.where = Sequelize.where;\nSequelize.prototype.validate = Sequelize.prototype.authenticate;\n/**\n * Sequelize version number.\n */\n\nSequelize.version = require('../package.json').version;\nSequelize.options = {\n  hooks: {}\n};\n/**\n * @private\n */\n\nSequelize.Utils = Utils;\n/**\n * Operators symbols to be used for querying data\n *\n * @see  {@link Operators}\n */\n\nSequelize.Op = Op;\n/**\n * Available table hints to be used for querying data in mssql for table hints\n *\n * @see {@link TableHints}\n */\n\nSequelize.TableHints = TableHints;\n/**\n * Available index hints to be used for querying data in mysql for index hints\n *\n * @see {@link IndexHints}\n */\n\nSequelize.IndexHints = IndexHints;\n/**\n * A reference to the sequelize transaction class. Use this to access isolationLevels and types when creating a transaction\n *\n * @see {@link Transaction}\n * @see {@link Sequelize.transaction}\n */\n\nSequelize.Transaction = Transaction;\n/**\n * A reference to Sequelize constructor from sequelize. Useful for accessing DataTypes, Errors etc.\n *\n * @see {@link Sequelize}\n */\n\nSequelize.prototype.Sequelize = Sequelize;\n/**\n * Available query types for use with `sequelize.query`\n *\n * @see {@link QueryTypes}\n */\n\nSequelize.prototype.QueryTypes = Sequelize.QueryTypes = QueryTypes;\n/**\n * Exposes the validator.js object, so you can extend it with custom validation functions. The validator is exposed both on the instance, and on the constructor.\n *\n * @see https://github.com/chriso/validator.js\n */\n\nSequelize.prototype.Validator = Sequelize.Validator = Validator;\nSequelize.Model = Model;\nSequelize.DataTypes = DataTypes;\n\nfor (const dataType in DataTypes) {\n  Sequelize[dataType] = DataTypes[dataType];\n}\n/**\n * A reference to the deferrable collection. Use this to access the different deferrable options.\n *\n * @see {@link Transaction.Deferrable}\n * @see {@link Sequelize#transaction}\n */\n\n\nSequelize.Deferrable = Deferrable;\n/**\n * A reference to the sequelize association class.\n *\n * @see {@link Association}\n */\n\nSequelize.prototype.Association = Sequelize.Association = Association;\n/**\n * Provide alternative version of `inflection` module to be used by `Utils.pluralize` etc.\n *\n * @param {object} _inflection - `inflection` module\n */\n\nSequelize.useInflection = Utils.useInflection;\n/**\n * Allow hooks to be defined on Sequelize + on sequelize instance as universal hooks to run on all models\n * and on Sequelize/sequelize methods e.g. Sequelize(), Sequelize#define()\n */\n\nHooks.applyTo(Sequelize);\nHooks.applyTo(Sequelize.prototype);\n/**\n * Expose various errors available\n */\n// expose alias to BaseError\n\nSequelize.Error = sequelizeErrors.BaseError;\n\nfor (const error of Object.keys(sequelizeErrors)) {\n  Sequelize[error] = sequelizeErrors[error];\n}\n\nmodule.exports = Sequelize;\nmodule.exports.Sequelize = Sequelize;\nmodule.exports.default = Sequelize;","map":{"version":3,"sources":["/home/nawan44/Documents/github/portofolio/CRUD/node_modules/sequelize/lib/sequelize.js"],"names":["url","require","path","retry","_","Utils","Model","DataTypes","Deferrable","ModelManager","Transaction","QueryTypes","TableHints","IndexHints","sequelizeErrors","Hooks","Association","Validator","validator","Op","deprecations","Sequelize","constructor","database","username","password","options","config","arguments","length","pick","urlParts","parse","dialect","protocol","replace","host","hostname","pathname","startsWith","storagePath","join","storage","resolve","port","auth","authParts","split","slice","query","dialectOptions","Object","assign","o","JSON","e","runHooks","dialectModule","dialectModulePath","define","sync","timezone","clientMinMessages","standardConformingStrings","logging","console","log","omitNull","native","replication","ssl","undefined","pool","quoteIdentifiers","hooks","max","match","transactionType","TYPES","DEFERRED","isolationLevel","databaseVersion","typeValidation","benchmark","minifyAliases","logQueryParameters","Error","noTrueLogging","_setupHooks","keepDefaultTimezone","Dialect","getDialect","queryGenerator","isPlainObject","operatorsAliases","noStringOperators","setOperatorsAliases","noBoolOperatorAliases","queryInterface","models","modelManager","connectionManager","refreshTypes","refreshTypeParser","getDatabaseName","getQueryInterface","modelName","attributes","sequelize","model","init","isDefined","getModel","find","name","sql","instance","raw","mapToModel","fieldMap","get","defaults","prototype","hasOwnProperty","call","searchPath","type","nest","plain","SELECT","RAW","supports","prependSearchPath","supportsSearchPath","values","replacements","bind","trim","Array","isArray","format","concat","formatNamedParameters","bindParameters","Query","formatBindParameters","checkTransaction","transaction","finished","completesTransaction","error","id","retryOptions","_cls","connection","getConnection","run","releaseConnection","set","variables","TypeError","map","v","k","escape","value","createSchema","schema","showAllSchemas","dropSchema","dropAllSchemas","test","force","drop","forEachModel","push","authenticate","truncate","reverse","cascade","Promise","all","random","dia","fn","args","Fn","col","Col","cast","val","Cast","literal","Literal","and","or","json","conditionsOrPath","Json","where","attr","comparator","logic","Where","autoCallback","prepareEnvironment","_clsRun","result","commit","err","rollback","err0","useCLS","ns","res","context","last","splice","close","normalizeDataType","Type","dialectTypes","key","extend","ARRAY","normalizeAttribute","attribute","defaultValue","NOW","UUIDV1","UUIDV4","ENUM","validate","version","dataType","useInflection","applyTo","BaseError","keys","module","exports","default"],"mappings":"AAAA;;AAEA,MAAMA,GAAG,GAAGC,OAAO,CAAC,KAAD,CAAnB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAD,CAApB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAC,mBAAD,CAArB;;AACA,MAAMG,CAAC,GAAGH,OAAO,CAAC,QAAD,CAAjB;;AAEA,MAAMI,KAAK,GAAGJ,OAAO,CAAC,SAAD,CAArB;;AACA,MAAMK,KAAK,GAAGL,OAAO,CAAC,SAAD,CAArB;;AACA,MAAMM,SAAS,GAAGN,OAAO,CAAC,cAAD,CAAzB;;AACA,MAAMO,UAAU,GAAGP,OAAO,CAAC,cAAD,CAA1B;;AACA,MAAMQ,YAAY,GAAGR,OAAO,CAAC,iBAAD,CAA5B;;AACA,MAAMS,WAAW,GAAGT,OAAO,CAAC,eAAD,CAA3B;;AACA,MAAMU,UAAU,GAAGV,OAAO,CAAC,eAAD,CAA1B;;AACA,MAAMW,UAAU,GAAGX,OAAO,CAAC,eAAD,CAA1B;;AACA,MAAMY,UAAU,GAAGZ,OAAO,CAAC,eAAD,CAA1B;;AACA,MAAMa,eAAe,GAAGb,OAAO,CAAC,UAAD,CAA/B;;AACA,MAAMc,KAAK,GAAGd,OAAO,CAAC,SAAD,CAArB;;AACA,MAAMe,WAAW,GAAGf,OAAO,CAAC,sBAAD,CAA3B;;AACA,MAAMgB,SAAS,GAAGhB,OAAO,CAAC,0BAAD,CAAP,CAAoCiB,SAAtD;;AACA,MAAMC,EAAE,GAAGlB,OAAO,CAAC,aAAD,CAAlB;;AACA,MAAMmB,YAAY,GAAGnB,OAAO,CAAC,sBAAD,CAA5B;AAEA;;;;;AAGA,MAAMoB,SAAN,CAAgB;AACd;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgJAC,EAAAA,WAAW,CAACC,QAAD,EAAWC,QAAX,EAAqBC,QAArB,EAA+BC,OAA/B,EAAwC;AACjD,QAAIC,MAAJ;;AAEA,QAAIC,SAAS,CAACC,MAAV,KAAqB,CAArB,IAA0B,OAAON,QAAP,KAAoB,QAAlD,EAA4D;AAC1D;AACAG,MAAAA,OAAO,GAAGH,QAAV;AACAI,MAAAA,MAAM,GAAGvB,CAAC,CAAC0B,IAAF,CAAOJ,OAAP,EAAgB,MAAhB,EAAwB,MAAxB,EAAgC,UAAhC,EAA4C,UAA5C,EAAwD,UAAxD,CAAT;AACD,KAJD,MAIO,IAAIE,SAAS,CAACC,MAAV,KAAqB,CAArB,IAA0B,OAAON,QAAP,KAAoB,QAA9C,IAA0DK,SAAS,CAACC,MAAV,KAAqB,CAArB,IAA0B,OAAOL,QAAP,KAAoB,QAA5G,EAAsH;AAC3H;AAEAG,MAAAA,MAAM,GAAG,EAAT;AACAD,MAAAA,OAAO,GAAGF,QAAQ,IAAI,EAAtB;AAEA,YAAMO,QAAQ,GAAG/B,GAAG,CAACgC,KAAJ,CAAUJ,SAAS,CAAC,CAAD,CAAnB,EAAwB,IAAxB,CAAjB;AAEAF,MAAAA,OAAO,CAACO,OAAR,GAAkBF,QAAQ,CAACG,QAAT,CAAkBC,OAAlB,CAA0B,IAA1B,EAAgC,EAAhC,CAAlB;AACAT,MAAAA,OAAO,CAACU,IAAR,GAAeL,QAAQ,CAACM,QAAxB;;AAEA,UAAIX,OAAO,CAACO,OAAR,KAAoB,QAApB,IAAgCF,QAAQ,CAACO,QAAzC,IAAqD,CAACP,QAAQ,CAACO,QAAT,CAAkBC,UAAlB,CAA6B,UAA7B,CAA1D,EAAoG;AAClG,cAAMC,WAAW,GAAGtC,IAAI,CAACuC,IAAL,CAAUf,OAAO,CAACU,IAAlB,EAAwBL,QAAQ,CAACO,QAAjC,CAApB;AACAZ,QAAAA,OAAO,CAACgB,OAAR,GAAkBxC,IAAI,CAACyC,OAAL,CAAajB,OAAO,CAACgB,OAAR,IAAmBF,WAAhC,CAAlB;AACD;;AAED,UAAIT,QAAQ,CAACO,QAAb,EAAuB;AACrBX,QAAAA,MAAM,CAACJ,QAAP,GAAkBQ,QAAQ,CAACO,QAAT,CAAkBH,OAAlB,CAA0B,KAA1B,EAAiC,EAAjC,CAAlB;AACD;;AAED,UAAIJ,QAAQ,CAACa,IAAb,EAAmB;AACjBlB,QAAAA,OAAO,CAACkB,IAAR,GAAeb,QAAQ,CAACa,IAAxB;AACD;;AAED,UAAIb,QAAQ,CAACc,IAAb,EAAmB;AACjB,cAAMC,SAAS,GAAGf,QAAQ,CAACc,IAAT,CAAcE,KAAd,CAAoB,GAApB,CAAlB;AAEApB,QAAAA,MAAM,CAACH,QAAP,GAAkBsB,SAAS,CAAC,CAAD,CAA3B;AAEA,YAAIA,SAAS,CAACjB,MAAV,GAAmB,CAAvB,EACEF,MAAM,CAACF,QAAP,GAAkBqB,SAAS,CAACE,KAAV,CAAgB,CAAhB,EAAmBP,IAAnB,CAAwB,GAAxB,CAAlB;AACH;;AAED,UAAIV,QAAQ,CAACkB,KAAb,EAAoB;AAClB;AACA;AACA;AACA,YAAIlB,QAAQ,CAACkB,KAAT,CAAeb,IAAnB,EAAyB;AACvBV,UAAAA,OAAO,CAACU,IAAR,GAAeL,QAAQ,CAACkB,KAAT,CAAeb,IAA9B;AACD;;AAED,YAAIV,OAAO,CAACwB,cAAZ,EAA4B;AAC1BC,UAAAA,MAAM,CAACC,MAAP,CAAc1B,OAAO,CAACwB,cAAtB,EAAsCnB,QAAQ,CAACkB,KAA/C;AACD,SAFD,MAEO;AACLvB,UAAAA,OAAO,CAACwB,cAAR,GAAyBnB,QAAQ,CAACkB,KAAlC;;AACA,cAAIlB,QAAQ,CAACkB,KAAT,CAAevB,OAAnB,EAA4B;AAC1B,gBAAI;AACF,oBAAM2B,CAAC,GAAGC,IAAI,CAACtB,KAAL,CAAWD,QAAQ,CAACkB,KAAT,CAAevB,OAA1B,CAAV;AACAA,cAAAA,OAAO,CAACwB,cAAR,CAAuBxB,OAAvB,GAAiC2B,CAAjC;AACD,aAHD,CAGE,OAAOE,CAAP,EAAU,CACV;AACA;AACD;AACF;AACF;AACF;AACF,KAxDM,MAwDA;AACL;AACA7B,MAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACAC,MAAAA,MAAM,GAAG;AAAEJ,QAAAA,QAAF;AAAYC,QAAAA,QAAZ;AAAsBC,QAAAA;AAAtB,OAAT;AACD;;AAEDJ,IAAAA,SAAS,CAACmC,QAAV,CAAmB,YAAnB,EAAiC7B,MAAjC,EAAyCD,OAAzC;AAEA,SAAKA,OAAL,GAAe;AACbO,MAAAA,OAAO,EAAE,IADI;AAEbwB,MAAAA,aAAa,EAAE,IAFF;AAGbC,MAAAA,iBAAiB,EAAE,IAHN;AAIbtB,MAAAA,IAAI,EAAE,WAJO;AAKbF,MAAAA,QAAQ,EAAE,KALG;AAMbyB,MAAAA,MAAM,EAAE,EANK;AAObV,MAAAA,KAAK,EAAE,EAPM;AAQbW,MAAAA,IAAI,EAAE,EARO;AASbC,MAAAA,QAAQ,EAAE,QATG;AAUbC,MAAAA,iBAAiB,EAAE,SAVN;AAWbC,MAAAA,yBAAyB,EAAE,IAXd;AAYb;AACAC,MAAAA,OAAO,EAAEC,OAAO,CAACC,GAbJ;AAcbC,MAAAA,QAAQ,EAAE,KAdG;AAebC,MAAAA,MAAM,EAAE,KAfK;AAgBbC,MAAAA,WAAW,EAAE,KAhBA;AAiBbC,MAAAA,GAAG,EAAEC,SAjBQ;AAkBbC,MAAAA,IAAI,EAAE,EAlBO;AAmBbC,MAAAA,gBAAgB,EAAE,IAnBL;AAoBbC,MAAAA,KAAK,EAAE,EApBM;AAqBbvE,MAAAA,KAAK,EAAE;AACLwE,QAAAA,GAAG,EAAE,CADA;AAELC,QAAAA,KAAK,EAAE,CACL,iCADK;AAFF,OArBM;AA2BbC,MAAAA,eAAe,EAAEnE,WAAW,CAACoE,KAAZ,CAAkBC,QA3BtB;AA4BbC,MAAAA,cAAc,EAAE,IA5BH;AA6BbC,MAAAA,eAAe,EAAE,CA7BJ;AA8BbC,MAAAA,cAAc,EAAE,KA9BH;AA+BbC,MAAAA,SAAS,EAAE,KA/BE;AAgCbC,MAAAA,aAAa,EAAE,KAhCF;AAiCbC,MAAAA,kBAAkB,EAAE,KAjCP;AAkCb,SAAG3D;AAlCU,KAAf;;AAqCA,QAAI,CAAC,KAAKA,OAAL,CAAaO,OAAlB,EAA2B;AACzB,YAAM,IAAIqD,KAAJ,CAAU,sDAAV,CAAN;AACD;;AAED,QAAI,KAAK5D,OAAL,CAAaO,OAAb,KAAyB,YAA7B,EAA2C;AACzC,WAAKP,OAAL,CAAaO,OAAb,GAAuB,UAAvB;AACD;;AAED,QAAI,KAAKP,OAAL,CAAaO,OAAb,KAAyB,QAAzB,IAAqC,KAAKP,OAAL,CAAamC,QAAb,KAA0B,QAAnE,EAA6E;AAC3E,YAAM,IAAIyB,KAAJ,CAAU,sIAAV,CAAN;AACD;;AAED,QAAI,KAAK5D,OAAL,CAAasC,OAAb,KAAyB,IAA7B,EAAmC;AACjC5C,MAAAA,YAAY,CAACmE,aAAb,GADiC,CAEjC;;AACA,WAAK7D,OAAL,CAAasC,OAAb,GAAuBC,OAAO,CAACC,GAA/B;AACD;;AAED,SAAKsB,WAAL,CAAiB9D,OAAO,CAACgD,KAAzB;;AAEA,SAAK/C,MAAL,GAAc;AACZJ,MAAAA,QAAQ,EAAEI,MAAM,CAACJ,QAAP,IAAmB,KAAKG,OAAL,CAAaH,QAD9B;AAEZC,MAAAA,QAAQ,EAAEG,MAAM,CAACH,QAAP,IAAmB,KAAKE,OAAL,CAAaF,QAF9B;AAGZC,MAAAA,QAAQ,EAAEE,MAAM,CAACF,QAAP,IAAmB,KAAKC,OAAL,CAAaD,QAAhC,IAA4C,IAH1C;AAIZW,MAAAA,IAAI,EAAET,MAAM,CAACS,IAAP,IAAe,KAAKV,OAAL,CAAaU,IAJtB;AAKZQ,MAAAA,IAAI,EAAEjB,MAAM,CAACiB,IAAP,IAAe,KAAKlB,OAAL,CAAakB,IALtB;AAMZ4B,MAAAA,IAAI,EAAE,KAAK9C,OAAL,CAAa8C,IANP;AAOZtC,MAAAA,QAAQ,EAAE,KAAKR,OAAL,CAAaQ,QAPX;AAQZkC,MAAAA,MAAM,EAAE,KAAK1C,OAAL,CAAa0C,MART;AASZE,MAAAA,GAAG,EAAE,KAAK5C,OAAL,CAAa4C,GATN;AAUZD,MAAAA,WAAW,EAAE,KAAK3C,OAAL,CAAa2C,WAVd;AAWZZ,MAAAA,aAAa,EAAE,KAAK/B,OAAL,CAAa+B,aAXhB;AAYZC,MAAAA,iBAAiB,EAAE,KAAKhC,OAAL,CAAagC,iBAZpB;AAaZ+B,MAAAA,mBAAmB,EAAE,KAAK/D,OAAL,CAAa+D,mBAbtB;AAcZvC,MAAAA,cAAc,EAAE,KAAKxB,OAAL,CAAawB;AAdjB,KAAd;AAiBA,QAAIwC,OAAJ,CAjJiD,CAkJjD;AACA;;AACA,YAAQ,KAAKC,UAAL,EAAR;AACE,WAAK,SAAL;AACED,QAAAA,OAAO,GAAGzF,OAAO,CAAC,oBAAD,CAAjB;AACA;;AACF,WAAK,OAAL;AACEyF,QAAAA,OAAO,GAAGzF,OAAO,CAAC,kBAAD,CAAjB;AACA;;AACF,WAAK,OAAL;AACEyF,QAAAA,OAAO,GAAGzF,OAAO,CAAC,kBAAD,CAAjB;AACA;;AACF,WAAK,UAAL;AACEyF,QAAAA,OAAO,GAAGzF,OAAO,CAAC,qBAAD,CAAjB;AACA;;AACF,WAAK,QAAL;AACEyF,QAAAA,OAAO,GAAGzF,OAAO,CAAC,mBAAD,CAAjB;AACA;;AACF;AACE,cAAM,IAAIqF,KAAJ,CAAW,eAAc,KAAKK,UAAL,EAAkB,qFAA3C,CAAN;AAjBJ;;AAoBA,SAAK1D,OAAL,GAAe,IAAIyD,OAAJ,CAAY,IAAZ,CAAf;AACA,SAAKzD,OAAL,CAAa2D,cAAb,CAA4BV,cAA5B,GAA6CxD,OAAO,CAACwD,cAArD;;AAEA,QAAI9E,CAAC,CAACyF,aAAF,CAAgB,KAAKnE,OAAL,CAAaoE,gBAA7B,CAAJ,EAAoD;AAClD1E,MAAAA,YAAY,CAAC2E,iBAAb;AACA,WAAK9D,OAAL,CAAa2D,cAAb,CAA4BI,mBAA5B,CAAgD,KAAKtE,OAAL,CAAaoE,gBAA7D;AACD,KAHD,MAGO,IAAI,OAAO,KAAKpE,OAAL,CAAaoE,gBAApB,KAAyC,SAA7C,EAAwD;AAC7D1E,MAAAA,YAAY,CAAC6E,qBAAb;AACD;;AAED,SAAKC,cAAL,GAAsB,KAAKjE,OAAL,CAAaiE,cAAnC;AAEA;;;;AAGA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,YAAL,GAAoB,IAAI3F,YAAJ,CAAiB,IAAjB,CAApB;AACA,SAAK4F,iBAAL,GAAyB,KAAKpE,OAAL,CAAaoE,iBAAtC;AAEAhF,IAAAA,SAAS,CAACmC,QAAV,CAAmB,WAAnB,EAAgC,IAAhC;AACD;AAED;;;;;;;AAKA8C,EAAAA,YAAY,GAAG;AACb,SAAKD,iBAAL,CAAuBE,iBAAvB,CAAyChG,SAAzC;AACD;AAED;;;;;;;AAKAoF,EAAAA,UAAU,GAAG;AACX,WAAO,KAAKjE,OAAL,CAAaO,OAApB;AACD;AAED;;;;;;;AAKAuE,EAAAA,eAAe,GAAG;AAChB,WAAO,KAAK7E,MAAL,CAAYJ,QAAnB;AACD;AAED;;;;;;;AAKAkF,EAAAA,iBAAiB,GAAG;AAClB,WAAO,KAAKP,cAAZ;AACD;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCAvC,EAAAA,MAAM,CAAC+C,SAAD,EAAYC,UAAZ,EAAwBjF,OAAO,GAAG,EAAlC,EAAsC;AAC1CA,IAAAA,OAAO,CAACgF,SAAR,GAAoBA,SAApB;AACAhF,IAAAA,OAAO,CAACkF,SAAR,GAAoB,IAApB;AAEA,UAAMC,KAAK,GAAG,cAAcvG,KAAd,CAAoB,EAAlC;AAEAuG,IAAAA,KAAK,CAACC,IAAN,CAAWH,UAAX,EAAuBjF,OAAvB;AAEA,WAAOmF,KAAP;AACD;AAED;;;;;;;;;;AAQAA,EAAAA,KAAK,CAACH,SAAD,EAAY;AACf,QAAI,CAAC,KAAKK,SAAL,CAAeL,SAAf,CAAL,EAAgC;AAC9B,YAAM,IAAIpB,KAAJ,CAAW,GAAEoB,SAAU,uBAAvB,CAAN;AACD;;AAED,WAAO,KAAKN,YAAL,CAAkBY,QAAlB,CAA2BN,SAA3B,CAAP;AACD;AAED;;;;;;;;;AAOAK,EAAAA,SAAS,CAACL,SAAD,EAAY;AACnB,WAAO,CAAC,CAAC,KAAKN,YAAL,CAAkBD,MAAlB,CAAyBc,IAAzB,CAA8BJ,KAAK,IAAIA,KAAK,CAACK,IAAN,KAAeR,SAAtD,CAAT;AACD;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCA,QAAMzD,KAAN,CAAYkE,GAAZ,EAAiBzF,OAAjB,EAA0B;AACxBA,IAAAA,OAAO,GAAG,EAAE,GAAG,KAAKA,OAAL,CAAauB,KAAlB;AAAyB,SAAGvB;AAA5B,KAAV;;AAEA,QAAIA,OAAO,CAAC0F,QAAR,IAAoB,CAAC1F,OAAO,CAACmF,KAAjC,EAAwC;AACtCnF,MAAAA,OAAO,CAACmF,KAAR,GAAgBnF,OAAO,CAAC0F,QAAR,CAAiB9F,WAAjC;AACD;;AAED,QAAI,CAACI,OAAO,CAAC0F,QAAT,IAAqB,CAAC1F,OAAO,CAACmF,KAAlC,EAAyC;AACvCnF,MAAAA,OAAO,CAAC2F,GAAR,GAAc,IAAd;AACD,KATuB,CAWxB;;;AACA,QAAI3F,OAAO,CAAC4F,UAAZ,EAAwB;AACtB5F,MAAAA,OAAO,CAAC6F,QAAR,GAAmBnH,CAAC,CAACoH,GAAF,CAAM9F,OAAN,EAAe,yBAAf,EAA0C,EAA1C,CAAnB;AACD;;AAEDA,IAAAA,OAAO,GAAGtB,CAAC,CAACqH,QAAF,CAAW/F,OAAX,EAAoB;AAC5B;AACAsC,MAAAA,OAAO,EAAEb,MAAM,CAACuE,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqC,KAAKlG,OAA1C,EAAmD,SAAnD,IAAgE,KAAKA,OAAL,CAAasC,OAA7E,GAAuFC,OAAO,CAACC,GAF5E;AAG5B2D,MAAAA,UAAU,EAAE1E,MAAM,CAACuE,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqC,KAAKlG,OAA1C,EAAmD,YAAnD,IAAmE,KAAKA,OAAL,CAAamG,UAAhF,GAA6F;AAH7E,KAApB,CAAV;;AAMA,QAAI,CAACnG,OAAO,CAACoG,IAAb,EAAmB;AACjB,UAAIpG,OAAO,CAACmF,KAAR,IAAiBnF,OAAO,CAACqG,IAAzB,IAAiCrG,OAAO,CAACsG,KAA7C,EAAoD;AAClDtG,QAAAA,OAAO,CAACoG,IAAR,GAAenH,UAAU,CAACsH,MAA1B;AACD,OAFD,MAEO;AACLvG,QAAAA,OAAO,CAACoG,IAAR,GAAenH,UAAU,CAACuH,GAA1B;AACD;AACF,KA5BuB,CA8BxB;AACA;;;AACA,QACE,CAAC,KAAKjG,OAAL,CAAakG,QAAb,CAAsBN,UAAvB,IACA,CAAC,KAAKnG,OAAL,CAAawB,cADd,IAEA,CAAC,KAAKxB,OAAL,CAAawB,cAAb,CAA4BkF,iBAF7B,IAGA1G,OAAO,CAAC2G,kBAAR,KAA+B,KAJjC,EAKE;AACA,aAAO3G,OAAO,CAACmG,UAAf;AACD,KAPD,MAOO,IAAI,CAACnG,OAAO,CAACmG,UAAb,EAAyB;AAC9B;AACA;AACAnG,MAAAA,OAAO,CAACmG,UAAR,GAAqB,SAArB;AACD;;AAED,QAAI,OAAOV,GAAP,KAAe,QAAnB,EAA6B;AAC3B,UAAIA,GAAG,CAACmB,MAAJ,KAAe/D,SAAnB,EAA8B;AAC5B,YAAI7C,OAAO,CAAC6G,YAAR,KAAyBhE,SAA7B,EAAwC;AACtC,gBAAM,IAAIe,KAAJ,CAAU,6EAAV,CAAN;AACD;;AACD5D,QAAAA,OAAO,CAAC6G,YAAR,GAAuBpB,GAAG,CAACmB,MAA3B;AACD;;AAED,UAAInB,GAAG,CAACqB,IAAJ,KAAajE,SAAjB,EAA4B;AAC1B,YAAI7C,OAAO,CAAC8G,IAAR,KAAiBjE,SAArB,EAAgC;AAC9B,gBAAM,IAAIe,KAAJ,CAAU,mEAAV,CAAN;AACD;;AACD5D,QAAAA,OAAO,CAAC8G,IAAR,GAAerB,GAAG,CAACqB,IAAnB;AACD;;AAED,UAAIrB,GAAG,CAAClE,KAAJ,KAAcsB,SAAlB,EAA6B;AAC3B4C,QAAAA,GAAG,GAAGA,GAAG,CAAClE,KAAV;AACD;AACF;;AAEDkE,IAAAA,GAAG,GAAGA,GAAG,CAACsB,IAAJ,EAAN;;AAEA,QAAI/G,OAAO,CAAC6G,YAAR,IAAwB7G,OAAO,CAAC8G,IAApC,EAA0C;AACxC,YAAM,IAAIlD,KAAJ,CAAU,+DAAV,CAAN;AACD;;AAED,QAAI5D,OAAO,CAAC6G,YAAZ,EAA0B;AACxB,UAAIG,KAAK,CAACC,OAAN,CAAcjH,OAAO,CAAC6G,YAAtB,CAAJ,EAAyC;AACvCpB,QAAAA,GAAG,GAAG9G,KAAK,CAACuI,MAAN,CAAa,CAACzB,GAAD,EAAM0B,MAAN,CAAanH,OAAO,CAAC6G,YAArB,CAAb,EAAiD,KAAK7G,OAAL,CAAaO,OAA9D,CAAN;AACD,OAFD,MAEO;AACLkF,QAAAA,GAAG,GAAG9G,KAAK,CAACyI,qBAAN,CAA4B3B,GAA5B,EAAiCzF,OAAO,CAAC6G,YAAzC,EAAuD,KAAK7G,OAAL,CAAaO,OAApE,CAAN;AACD;AACF;;AAED,QAAI8G,cAAJ;;AAEA,QAAIrH,OAAO,CAAC8G,IAAZ,EAAkB;AAChB,OAACrB,GAAD,EAAM4B,cAAN,IAAwB,KAAK9G,OAAL,CAAa+G,KAAb,CAAmBC,oBAAnB,CAAwC9B,GAAxC,EAA6CzF,OAAO,CAAC8G,IAArD,EAA2D,KAAK9G,OAAL,CAAaO,OAAxE,CAAxB;AACD;;AAED,UAAMiH,gBAAgB,GAAG,MAAM;AAC7B,UAAIxH,OAAO,CAACyH,WAAR,IAAuBzH,OAAO,CAACyH,WAAR,CAAoBC,QAA3C,IAAuD,CAAC1H,OAAO,CAAC2H,oBAApE,EAA0F;AACxF,cAAMC,KAAK,GAAG,IAAIhE,KAAJ,CAAW,GAAE5D,OAAO,CAACyH,WAAR,CAAoBC,QAAS,wCAAuC1H,OAAO,CAACyH,WAAR,CAAoBI,EAAG,mGAAxG,CAAd;AACAD,QAAAA,KAAK,CAACnC,GAAN,GAAYA,GAAZ;AACA,cAAMmC,KAAN;AACD;AACF,KAND;;AAQA,UAAME,YAAY,GAAG,EAAE,GAAG,KAAK9H,OAAL,CAAavB,KAAlB;AAAyB,SAAGuB,OAAO,CAACvB;AAApC,KAArB;AAEA,WAAOA,KAAK,CAAC,YAAY;AACvB,UAAIuB,OAAO,CAACyH,WAAR,KAAwB5E,SAAxB,IAAqClD,SAAS,CAACoI,IAAnD,EAAyD;AACvD/H,QAAAA,OAAO,CAACyH,WAAR,GAAsB9H,SAAS,CAACoI,IAAV,CAAejC,GAAf,CAAmB,aAAnB,CAAtB;AACD;;AAED0B,MAAAA,gBAAgB;AAEhB,YAAMQ,UAAU,GAAG,OAAOhI,OAAO,CAACyH,WAAR,GAAsBzH,OAAO,CAACyH,WAAR,CAAoBO,UAA1C,GAAuD,KAAKrD,iBAAL,CAAuBsD,aAAvB,CAAqCjI,OAArC,CAA9D,CAAnB;AACA,YAAMuB,KAAK,GAAG,IAAI,KAAKhB,OAAL,CAAa+G,KAAjB,CAAuBU,UAAvB,EAAmC,IAAnC,EAAyChI,OAAzC,CAAd;;AAEA,UAAI;AACF,cAAM,KAAK8B,QAAL,CAAc,aAAd,EAA6B9B,OAA7B,EAAsCuB,KAAtC,CAAN;AACAiG,QAAAA,gBAAgB;AAChB,eAAO,MAAMjG,KAAK,CAAC2G,GAAN,CAAUzC,GAAV,EAAe4B,cAAf,CAAb;AACD,OAJD,SAIU;AACR,cAAM,KAAKvF,QAAL,CAAc,YAAd,EAA4B9B,OAA5B,EAAqCuB,KAArC,CAAN;;AACA,YAAI,CAACvB,OAAO,CAACyH,WAAb,EAA0B;AACxB,gBAAM,KAAK9C,iBAAL,CAAuBwD,iBAAvB,CAAyCH,UAAzC,CAAN;AACD;AACF;AACF,KApBW,EAoBTF,YApBS,CAAZ;AAqBD;AAED;;;;;;;;;;;;;;AAYA,QAAMM,GAAN,CAAUC,SAAV,EAAqBrI,OAArB,EAA8B;AAE5B;AACAA,IAAAA,OAAO,GAAG,EAAE,GAAG,KAAKA,OAAL,CAAaoI,GAAlB;AAAuB,UAAG,OAAOpI,OAAP,KAAmB,QAAnB,IAA+BA,OAAlC;AAAvB,KAAV;;AAEA,QAAI,KAAKA,OAAL,CAAaO,OAAb,KAAyB,OAA7B,EAAsC;AACpC,YAAM,IAAIqD,KAAJ,CAAU,2CAAV,CAAN;AACD;;AACD,QAAI,CAAC5D,OAAO,CAACyH,WAAT,IAAwB,EAAEzH,OAAO,CAACyH,WAAR,YAA+BzI,WAAjC,CAA5B,EAA4E;AAC1E,YAAM,IAAIsJ,SAAJ,CAAc,iCAAd,CAAN;AACD,KAV2B,CAY5B;;;AACAtI,IAAAA,OAAO,CAAC2F,GAAR,GAAc,IAAd;AACA3F,IAAAA,OAAO,CAACsG,KAAR,GAAgB,IAAhB;AACAtG,IAAAA,OAAO,CAACoG,IAAR,GAAe,KAAf,CAf4B,CAiB5B;;AACA,UAAM7E,KAAK,GACR,OACC7C,CAAC,CAAC6J,GAAF,CAAMF,SAAN,EAAiB,CAACG,CAAD,EAAIC,CAAJ,KAAW,IAAGA,CAAE,OAAM,OAAOD,CAAP,KAAa,QAAb,GAAyB,IAAGA,CAAE,GAA9B,GAAmCA,CAAE,EAA5E,EAA+EzH,IAA/E,CAAoF,IAApF,CAA0F,EAF9F;AAIA,WAAO,MAAM,KAAKQ,KAAL,CAAWA,KAAX,EAAkBvB,OAAlB,CAAb;AACD;AAED;;;;;;;;;AAOA0I,EAAAA,MAAM,CAACC,KAAD,EAAQ;AACZ,WAAO,KAAKpI,OAAL,CAAa2D,cAAb,CAA4BwE,MAA5B,CAAmCC,KAAnC,CAAP;AACD;AAED;;;;;;;;;;;;;;;;;AAeA,QAAMC,YAAN,CAAmBC,MAAnB,EAA2B7I,OAA3B,EAAoC;AAClC,WAAO,MAAM,KAAK+E,iBAAL,GAAyB6D,YAAzB,CAAsCC,MAAtC,EAA8C7I,OAA9C,CAAb;AACD;AAED;;;;;;;;;;;;;AAWA,QAAM8I,cAAN,CAAqB9I,OAArB,EAA8B;AAC5B,WAAO,MAAM,KAAK+E,iBAAL,GAAyB+D,cAAzB,CAAwC9I,OAAxC,CAAb;AACD;AAED;;;;;;;;;;;;;;AAYA,QAAM+I,UAAN,CAAiBF,MAAjB,EAAyB7I,OAAzB,EAAkC;AAChC,WAAO,MAAM,KAAK+E,iBAAL,GAAyBgE,UAAzB,CAAoCF,MAApC,EAA4C7I,OAA5C,CAAb;AACD;AAED;;;;;;;;;;;;;AAWA,QAAMgJ,cAAN,CAAqBhJ,OAArB,EAA8B;AAC5B,WAAO,MAAM,KAAK+E,iBAAL,GAAyBiE,cAAzB,CAAwChJ,OAAxC,CAAb;AACD;AAED;;;;;;;;;;;;;;;;;AAeA,QAAMkC,IAAN,CAAWlC,OAAX,EAAoB;AAClBA,IAAAA,OAAO,GAAG,EACR,GAAG,KAAKA,OADA;AAER,SAAG,KAAKA,OAAL,CAAakC,IAFR;AAGR,SAAGlC,OAHK;AAIRgD,MAAAA,KAAK,EAAEhD,OAAO,GAAGA,OAAO,CAACgD,KAAR,KAAkB,KAArB,GAA6B;AAJnC,KAAV;;AAOA,QAAIhD,OAAO,CAACkD,KAAZ,EAAmB;AACjB,UAAI,CAAClD,OAAO,CAACkD,KAAR,CAAc+F,IAAd,CAAmB,KAAKhJ,MAAL,CAAYJ,QAA/B,CAAL,EAA+C;AAC7C,cAAM,IAAI+D,KAAJ,CAAW,aAAY,KAAK3D,MAAL,CAAYJ,QAAS,0CAAyCG,OAAO,CAACkD,KAAM,GAAnG,CAAN;AACD;AACF;;AAED,QAAIlD,OAAO,CAACgD,KAAZ,EAAmB;AACjB,YAAM,KAAKlB,QAAL,CAAc,gBAAd,EAAgC9B,OAAhC,CAAN;AACD;;AACD,QAAIA,OAAO,CAACkJ,KAAZ,EAAmB;AACjB,YAAM,KAAKC,IAAL,CAAUnJ,OAAV,CAAN;AACD;;AACD,UAAMyE,MAAM,GAAG,EAAf,CApBkB,CAsBlB;AACA;;AACA,SAAKC,YAAL,CAAkB0E,YAAlB,CAA+BjE,KAAK,IAAI;AACtC,UAAIA,KAAJ,EAAW;AACTV,QAAAA,MAAM,CAAC4E,IAAP,CAAYlE,KAAZ;AACD,OAFD,MAEO,CACL;AACD;AACF,KAND,EAxBkB,CAgClB;;AACA,QAAI,CAACV,MAAM,CAACtE,MAAZ,EAAoB;AAClB,YAAM,KAAKmJ,YAAL,CAAkBtJ,OAAlB,CAAN;AACD,KAFD,MAEO;AACL,WAAK,MAAMmF,KAAX,IAAoBV,MAApB,EAA4B,MAAMU,KAAK,CAACjD,IAAN,CAAWlC,OAAX,CAAN;AAC7B;;AACD,QAAIA,OAAO,CAACgD,KAAZ,EAAmB;AACjB,YAAM,KAAKlB,QAAL,CAAc,eAAd,EAA+B9B,OAA/B,CAAN;AACD;;AACD,WAAO,IAAP;AACD;AAED;;;;;;;;;;;;;AAWA,QAAMuJ,QAAN,CAAevJ,OAAf,EAAwB;AACtB,UAAMyE,MAAM,GAAG,EAAf;AAEA,SAAKC,YAAL,CAAkB0E,YAAlB,CAA+BjE,KAAK,IAAI;AACtC,UAAIA,KAAJ,EAAW;AACTV,QAAAA,MAAM,CAAC4E,IAAP,CAAYlE,KAAZ;AACD;AACF,KAJD,EAIG;AAAEqE,MAAAA,OAAO,EAAE;AAAX,KAJH;;AAMA,QAAIxJ,OAAO,IAAIA,OAAO,CAACyJ,OAAvB,EAAgC;AAC9B,WAAK,MAAMtE,KAAX,IAAoBV,MAApB,EAA4B,MAAMU,KAAK,CAACoE,QAAN,CAAevJ,OAAf,CAAN;AAC7B,KAFD,MAEO;AACL,YAAM0J,OAAO,CAACC,GAAR,CAAYlF,MAAM,CAAC8D,GAAP,CAAWpD,KAAK,IAAIA,KAAK,CAACoE,QAAN,CAAevJ,OAAf,CAApB,CAAZ,CAAN;AACD;AACF;AAED;;;;;;;;;;;;;;AAYA,QAAMmJ,IAAN,CAAWnJ,OAAX,EAAoB;AAClB,UAAMyE,MAAM,GAAG,EAAf;AAEA,SAAKC,YAAL,CAAkB0E,YAAlB,CAA+BjE,KAAK,IAAI;AACtC,UAAIA,KAAJ,EAAW;AACTV,QAAAA,MAAM,CAAC4E,IAAP,CAAYlE,KAAZ;AACD;AACF,KAJD,EAIG;AAAEqE,MAAAA,OAAO,EAAE;AAAX,KAJH;;AAMA,SAAK,MAAMrE,KAAX,IAAoBV,MAApB,EAA4B,MAAMU,KAAK,CAACgE,IAAN,CAAWnJ,OAAX,CAAN;AAC7B;AAED;;;;;;;;;AAOA,QAAMsJ,YAAN,CAAmBtJ,OAAnB,EAA4B;AAC1BA,IAAAA,OAAO,GAAG;AACR2F,MAAAA,GAAG,EAAE,IADG;AAERW,MAAAA,KAAK,EAAE,IAFC;AAGRF,MAAAA,IAAI,EAAEnH,UAAU,CAACsH,MAHT;AAIR,SAAGvG;AAJK,KAAV;AAOA,UAAM,KAAKuB,KAAL,CAAW,sBAAX,EAAmCvB,OAAnC,CAAN;AAEA;AACD;;AAED,QAAMuD,eAAN,CAAsBvD,OAAtB,EAA+B;AAC7B,WAAO,MAAM,KAAK+E,iBAAL,GAAyBxB,eAAzB,CAAyCvD,OAAzC,CAAb;AACD;AAED;;;;;;;AAKA4J,EAAAA,MAAM,GAAG;AACP,UAAMC,GAAG,GAAG,KAAK5F,UAAL,EAAZ;;AACA,QAAI4F,GAAG,KAAK,UAAR,IAAsBA,GAAG,KAAK,QAAlC,EAA4C;AAC1C,aAAO,KAAKC,EAAL,CAAQ,QAAR,CAAP;AACD;;AACD,WAAO,KAAKA,EAAL,CAAQ,MAAR,CAAP;AACD;AAED;;;;;;;;;;;;;;;;;;;;;;;;;AAuBA,SAAOA,EAAP,CAAUA,EAAV,EAAc,GAAGC,IAAjB,EAAuB;AACrB,WAAO,IAAIpL,KAAK,CAACqL,EAAV,CAAaF,EAAb,EAAiBC,IAAjB,CAAP;AACD;AAED;;;;;;;;;;;;;;AAYA,SAAOE,GAAP,CAAWA,GAAX,EAAgB;AACd,WAAO,IAAItL,KAAK,CAACuL,GAAV,CAAcD,GAAd,CAAP;AACD;AAED;;;;;;;;;;;;AAUA,SAAOE,IAAP,CAAYC,GAAZ,EAAiBhE,IAAjB,EAAuB;AACrB,WAAO,IAAIzH,KAAK,CAAC0L,IAAV,CAAeD,GAAf,EAAoBhE,IAApB,CAAP;AACD;AAED;;;;;;;;;;;AASA,SAAOkE,OAAP,CAAeF,GAAf,EAAoB;AAClB,WAAO,IAAIzL,KAAK,CAAC4L,OAAV,CAAkBH,GAAlB,CAAP;AACD;AAED;;;;;;;;;;;;;;AAYA,SAAOI,GAAP,CAAW,GAAGT,IAAd,EAAoB;AAClB,WAAO;AAAE,OAACtK,EAAE,CAAC+K,GAAJ,GAAUT;AAAZ,KAAP;AACD;AAED;;;;;;;;;;;;;;AAYA,SAAOU,EAAP,CAAU,GAAGV,IAAb,EAAmB;AACjB,WAAO;AAAE,OAACtK,EAAE,CAACgL,EAAJ,GAASV;AAAX,KAAP;AACD;AAED;;;;;;;;;;;;;;AAYA,SAAOW,IAAP,CAAYC,gBAAZ,EAA8BhC,KAA9B,EAAqC;AACnC,WAAO,IAAIhK,KAAK,CAACiM,IAAV,CAAeD,gBAAf,EAAiChC,KAAjC,CAAP;AACD;AAED;;;;;;;;;;;;;;;;;;AAgBA,SAAOkC,KAAP,CAAaC,IAAb,EAAmBC,UAAnB,EAA+BC,KAA/B,EAAsC;AACpC,WAAO,IAAIrM,KAAK,CAACsM,KAAV,CAAgBH,IAAhB,EAAsBC,UAAtB,EAAkCC,KAAlC,CAAP;AACD;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA,QAAMvD,WAAN,CAAkBzH,OAAlB,EAA2BkL,YAA3B,EAAyC;AACvC,QAAI,OAAOlL,OAAP,KAAmB,UAAvB,EAAmC;AACjCkL,MAAAA,YAAY,GAAGlL,OAAf;AACAA,MAAAA,OAAO,GAAG6C,SAAV;AACD;;AAED,UAAM4E,WAAW,GAAG,IAAIzI,WAAJ,CAAgB,IAAhB,EAAsBgB,OAAtB,CAApB;;AAEA,QAAI,CAACkL,YAAL,EAAmB;AACjB,YAAMzD,WAAW,CAAC0D,kBAAZ,CAA+B,KAA/B,CAAN;AACA,aAAO1D,WAAP;AACD,KAXsC,CAavC;;;AACA,WAAO9H,SAAS,CAACyL,OAAV,CAAkB,YAAY;AACnC,UAAI;AACF,cAAM3D,WAAW,CAAC0D,kBAAZ,EAAN;AACA,cAAME,MAAM,GAAG,MAAMH,YAAY,CAACzD,WAAD,CAAjC;AACA,cAAMA,WAAW,CAAC6D,MAAZ,EAAN;AACA,eAAO,MAAMD,MAAb;AACD,OALD,CAKE,OAAOE,GAAP,EAAY;AACZ,YAAI,CAAC9D,WAAW,CAACC,QAAjB,EAA2B;AACzB,cAAI;AACF,kBAAMD,WAAW,CAAC+D,QAAZ,EAAN;AACD,WAFD,CAEE,OAAOC,IAAP,EAAa,CACb;AACD;AACF;;AACD,cAAMF,GAAN;AACD;AACF,KAhBM,CAAP;AAiBD;AAED;;;;;;;;;AAOA,SAAOG,MAAP,CAAcC,EAAd,EAAkB;AAChB;AACA,QAAI,CAACA,EAAD,IAAO,OAAOA,EAAP,KAAc,QAArB,IAAiC,OAAOA,EAAE,CAAC7E,IAAV,KAAmB,UAApD,IAAkE,OAAO6E,EAAE,CAACzD,GAAV,KAAkB,UAAxF,EAAoG,MAAM,IAAItE,KAAJ,CAAU,4BAAV,CAAN,CAFpF,CAIhB;;AACA,SAAKmE,IAAL,GAAY4D,EAAZ,CALgB,CAOhB;;AACA,WAAO,IAAP;AACD;AAED;;;;;;;;;;AAQA,SAAOP,OAAP,CAAetB,EAAf,EAAmB;AACjB,UAAM6B,EAAE,GAAGhM,SAAS,CAACoI,IAArB;AACA,QAAI,CAAC4D,EAAL,EAAS,OAAO7B,EAAE,EAAT;AAET,QAAI8B,GAAJ;AACAD,IAAAA,EAAE,CAACzD,GAAH,CAAO2D,OAAO,IAAID,GAAG,GAAG9B,EAAE,CAAC+B,OAAD,CAA1B;AACA,WAAOD,GAAP;AACD;;AAEDpJ,EAAAA,GAAG,CAAC,GAAGuH,IAAJ,EAAU;AACX,QAAI/J,OAAJ;;AAEA,UAAM8L,IAAI,GAAGpN,CAAC,CAACoN,IAAF,CAAO/B,IAAP,CAAb;;AAEA,QAAI+B,IAAI,IAAIpN,CAAC,CAACyF,aAAF,CAAgB2H,IAAhB,CAAR,IAAiCrK,MAAM,CAACuE,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqC4F,IAArC,EAA2C,SAA3C,CAArC,EAA4F;AAC1F9L,MAAAA,OAAO,GAAG8L,IAAV,CAD0F,CAG1F;AACA;;AACA,UAAI9L,OAAO,CAACsC,OAAR,KAAoBC,OAAO,CAACC,GAAhC,EAAqC;AACnCuH,QAAAA,IAAI,CAACgC,MAAL,CAAYhC,IAAI,CAAC5J,MAAL,GAAc,CAA1B,EAA6B,CAA7B;AACD;AACF,KARD,MAQO;AACLH,MAAAA,OAAO,GAAG,KAAKA,OAAf;AACD;;AAED,QAAIA,OAAO,CAACsC,OAAZ,EAAqB;AACnB,UAAItC,OAAO,CAACsC,OAAR,KAAoB,IAAxB,EAA8B;AAC5B5C,QAAAA,YAAY,CAACmE,aAAb,GAD4B,CAE5B;;AACA7D,QAAAA,OAAO,CAACsC,OAAR,GAAkBC,OAAO,CAACC,GAA1B;AACD,OALkB,CAOnB;AACA;;;AACA,UAAI,CAAC,KAAKxC,OAAL,CAAayD,SAAb,IAA0BzD,OAAO,CAACyD,SAAnC,KAAiDzD,OAAO,CAACsC,OAAR,KAAoBC,OAAO,CAACC,GAAjF,EAAsF;AACpFuH,QAAAA,IAAI,GAAG,CAAE,GAAEA,IAAI,CAAC,CAAD,CAAI,kBAAiBA,IAAI,CAAC,CAAD,CAAI,IAArC,CAAP;AACD;;AAED/J,MAAAA,OAAO,CAACsC,OAAR,CAAgB,GAAGyH,IAAnB;AACD;AACF;AAED;;;;;;;;;;AAQAiC,EAAAA,KAAK,GAAG;AACN,WAAO,KAAKrH,iBAAL,CAAuBqH,KAAvB,EAAP;AACD;;AAEDC,EAAAA,iBAAiB,CAACC,IAAD,EAAO;AACtB,QAAI9F,IAAI,GAAG,OAAO8F,IAAP,KAAgB,UAAhB,GAA6B,IAAIA,IAAJ,EAA7B,GAA0CA,IAArD;AACA,UAAMC,YAAY,GAAG,KAAK5L,OAAL,CAAa1B,SAAb,IAA0B,EAA/C;;AAEA,QAAIsN,YAAY,CAAC/F,IAAI,CAACgG,GAAN,CAAhB,EAA4B;AAC1BhG,MAAAA,IAAI,GAAG+F,YAAY,CAAC/F,IAAI,CAACgG,GAAN,CAAZ,CAAuBC,MAAvB,CAA8BjG,IAA9B,CAAP;AACD;;AAED,QAAIA,IAAI,YAAYvH,SAAS,CAACyN,KAA9B,EAAqC;AACnC,UAAI,CAAClG,IAAI,CAACA,IAAV,EAAgB;AACd,cAAM,IAAIxC,KAAJ,CAAU,kDAAV,CAAN;AACD;;AACD,UAAIuI,YAAY,CAAC/F,IAAI,CAACA,IAAL,CAAUgG,GAAX,CAAhB,EAAiC;AAC/BhG,QAAAA,IAAI,CAACA,IAAL,GAAY+F,YAAY,CAAC/F,IAAI,CAACA,IAAL,CAAUgG,GAAX,CAAZ,CAA4BC,MAA5B,CAAmCjG,IAAI,CAACA,IAAxC,CAAZ;AACD;AACF;;AAED,WAAOA,IAAP;AACD;;AAEDmG,EAAAA,kBAAkB,CAACC,SAAD,EAAY;AAC5B,QAAI,CAAC9N,CAAC,CAACyF,aAAF,CAAgBqI,SAAhB,CAAL,EAAiC;AAC/BA,MAAAA,SAAS,GAAG;AAAEpG,QAAAA,IAAI,EAAEoG;AAAR,OAAZ;AACD;;AAED,QAAI,CAACA,SAAS,CAACpG,IAAf,EAAqB,OAAOoG,SAAP;AAErBA,IAAAA,SAAS,CAACpG,IAAV,GAAiB,KAAK6F,iBAAL,CAAuBO,SAAS,CAACpG,IAAjC,CAAjB;;AAEA,QAAI3E,MAAM,CAACuE,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCsG,SAArC,EAAgD,cAAhD,CAAJ,EAAqE;AACnE,UAAI,OAAOA,SAAS,CAACC,YAAjB,KAAkC,UAAlC,KACFD,SAAS,CAACC,YAAV,KAA2B5N,SAAS,CAAC6N,GAArC,IACEF,SAAS,CAACC,YAAV,KAA2B5N,SAAS,CAAC8N,MADvC,IAEEH,SAAS,CAACC,YAAV,KAA2B5N,SAAS,CAAC+N,MAHrC,CAAJ,EAIG;AACDJ,QAAAA,SAAS,CAACC,YAAV,GAAyB,IAAID,SAAS,CAACC,YAAd,EAAzB;AACD;AACF;;AAED,QAAID,SAAS,CAACpG,IAAV,YAA0BvH,SAAS,CAACgO,IAAxC,EAA8C;AAC5C;AACA,UAAIL,SAAS,CAAC5F,MAAd,EAAsB;AACpB4F,QAAAA,SAAS,CAACpG,IAAV,CAAeQ,MAAf,GAAwB4F,SAAS,CAACpG,IAAV,CAAepG,OAAf,CAAuB4G,MAAvB,GAAgC4F,SAAS,CAAC5F,MAAlE;AACD,OAFD,MAEO;AACL4F,QAAAA,SAAS,CAAC5F,MAAV,GAAmB4F,SAAS,CAACpG,IAAV,CAAeQ,MAAlC;AACD;;AAED,UAAI,CAAC4F,SAAS,CAAC5F,MAAV,CAAiBzG,MAAtB,EAA8B;AAC5B,cAAM,IAAIyD,KAAJ,CAAU,wCAAV,CAAN;AACD;AACF;;AAED,WAAO4I,SAAP;AACD;;AA7rCa,C,CAgsChB;;;AACA7M,SAAS,CAACqG,SAAV,CAAoB8D,EAApB,GAAyBnK,SAAS,CAACmK,EAAnC;AACAnK,SAAS,CAACqG,SAAV,CAAoBiE,GAApB,GAA0BtK,SAAS,CAACsK,GAApC;AACAtK,SAAS,CAACqG,SAAV,CAAoBmE,IAApB,GAA2BxK,SAAS,CAACwK,IAArC;AACAxK,SAAS,CAACqG,SAAV,CAAoBsE,OAApB,GAA8B3K,SAAS,CAAC2K,OAAxC;AACA3K,SAAS,CAACqG,SAAV,CAAoBwE,GAApB,GAA0B7K,SAAS,CAAC6K,GAApC;AACA7K,SAAS,CAACqG,SAAV,CAAoByE,EAApB,GAAyB9K,SAAS,CAAC8K,EAAnC;AACA9K,SAAS,CAACqG,SAAV,CAAoB0E,IAApB,GAA2B/K,SAAS,CAAC+K,IAArC;AACA/K,SAAS,CAACqG,SAAV,CAAoB6E,KAApB,GAA4BlL,SAAS,CAACkL,KAAtC;AACAlL,SAAS,CAACqG,SAAV,CAAoB8G,QAApB,GAA+BnN,SAAS,CAACqG,SAAV,CAAoBsD,YAAnD;AAEA;;;;AAGA3J,SAAS,CAACoN,OAAV,GAAoBxO,OAAO,CAAC,iBAAD,CAAP,CAA2BwO,OAA/C;AAEApN,SAAS,CAACK,OAAV,GAAoB;AAAEgD,EAAAA,KAAK,EAAE;AAAT,CAApB;AAEA;;;;AAGArD,SAAS,CAAChB,KAAV,GAAkBA,KAAlB;AAEA;;;;;;AAKAgB,SAAS,CAACF,EAAV,GAAeA,EAAf;AAEA;;;;;;AAKAE,SAAS,CAACT,UAAV,GAAuBA,UAAvB;AAEA;;;;;;AAKAS,SAAS,CAACR,UAAV,GAAuBA,UAAvB;AAEA;;;;;;;AAMAQ,SAAS,CAACX,WAAV,GAAwBA,WAAxB;AAEA;;;;;;AAKAW,SAAS,CAACqG,SAAV,CAAoBrG,SAApB,GAAgCA,SAAhC;AAEA;;;;;;AAKAA,SAAS,CAACqG,SAAV,CAAoB/G,UAApB,GAAiCU,SAAS,CAACV,UAAV,GAAuBA,UAAxD;AAEA;;;;;;AAKAU,SAAS,CAACqG,SAAV,CAAoBzG,SAApB,GAAgCI,SAAS,CAACJ,SAAV,GAAsBA,SAAtD;AAEAI,SAAS,CAACf,KAAV,GAAkBA,KAAlB;AAEAe,SAAS,CAACd,SAAV,GAAsBA,SAAtB;;AACA,KAAK,MAAMmO,QAAX,IAAuBnO,SAAvB,EAAkC;AAChCc,EAAAA,SAAS,CAACqN,QAAD,CAAT,GAAsBnO,SAAS,CAACmO,QAAD,CAA/B;AACD;AAED;;;;;;;;AAMArN,SAAS,CAACb,UAAV,GAAuBA,UAAvB;AAEA;;;;;;AAKAa,SAAS,CAACqG,SAAV,CAAoB1G,WAApB,GAAkCK,SAAS,CAACL,WAAV,GAAwBA,WAA1D;AAEA;;;;;;AAKAK,SAAS,CAACsN,aAAV,GAA0BtO,KAAK,CAACsO,aAAhC;AAEA;;;;;AAIA5N,KAAK,CAAC6N,OAAN,CAAcvN,SAAd;AACAN,KAAK,CAAC6N,OAAN,CAAcvN,SAAS,CAACqG,SAAxB;AAEA;;;AAIA;;AACArG,SAAS,CAACiE,KAAV,GAAkBxE,eAAe,CAAC+N,SAAlC;;AAEA,KAAK,MAAMvF,KAAX,IAAoBnG,MAAM,CAAC2L,IAAP,CAAYhO,eAAZ,CAApB,EAAkD;AAChDO,EAAAA,SAAS,CAACiI,KAAD,CAAT,GAAmBxI,eAAe,CAACwI,KAAD,CAAlC;AACD;;AAEDyF,MAAM,CAACC,OAAP,GAAiB3N,SAAjB;AACA0N,MAAM,CAACC,OAAP,CAAe3N,SAAf,GAA2BA,SAA3B;AACA0N,MAAM,CAACC,OAAP,CAAeC,OAAf,GAAyB5N,SAAzB","sourcesContent":["'use strict';\n\nconst url = require('url');\nconst path = require('path');\nconst retry = require('retry-as-promised');\nconst _ = require('lodash');\n\nconst Utils = require('./utils');\nconst Model = require('./model');\nconst DataTypes = require('./data-types');\nconst Deferrable = require('./deferrable');\nconst ModelManager = require('./model-manager');\nconst Transaction = require('./transaction');\nconst QueryTypes = require('./query-types');\nconst TableHints = require('./table-hints');\nconst IndexHints = require('./index-hints');\nconst sequelizeErrors = require('./errors');\nconst Hooks = require('./hooks');\nconst Association = require('./associations/index');\nconst Validator = require('./utils/validator-extras').validator;\nconst Op = require('./operators');\nconst deprecations = require('./utils/deprecations');\n\n/**\n * This is the main class, the entry point to sequelize.\n */\nclass Sequelize {\n  /**\n   * Instantiate sequelize with name of database, username and password.\n   *\n   * @example\n   * // without password / with blank password\n   * const sequelize = new Sequelize('database', 'username', null, {\n   *   dialect: 'mysql'\n   * })\n   *\n   * // with password and options\n   * const sequelize = new Sequelize('my_database', 'john', 'doe', {\n   *   dialect: 'postgres'\n   * })\n   *\n   * // with database, username, and password in the options object\n   * const sequelize = new Sequelize({ database, username, password, dialect: 'mssql' });\n   *\n   * // with uri\n   * const sequelize = new Sequelize('mysql://localhost:3306/database', {})\n   *\n   * // option examples\n   * const sequelize = new Sequelize('database', 'username', 'password', {\n   *   // the sql dialect of the database\n   *   // currently supported: 'mysql', 'sqlite', 'postgres', 'mssql'\n   *   dialect: 'mysql',\n   *\n   *   // custom host; default: localhost\n   *   host: 'my.server.tld',\n   *   // for postgres, you can also specify an absolute path to a directory\n   *   // containing a UNIX socket to connect over\n   *   // host: '/sockets/psql_sockets'.\n   *\n   *   // custom port; default: dialect default\n   *   port: 12345,\n   *\n   *   // custom protocol; default: 'tcp'\n   *   // postgres only, useful for Heroku\n   *   protocol: null,\n   *\n   *   // disable logging or provide a custom logging function; default: console.log\n   *   logging: false,\n   *\n   *   // you can also pass any dialect options to the underlying dialect library\n   *   // - default is empty\n   *   // - currently supported: 'mysql', 'postgres', 'mssql'\n   *   dialectOptions: {\n   *     socketPath: '/Applications/MAMP/tmp/mysql/mysql.sock',\n   *     supportBigNumbers: true,\n   *     bigNumberStrings: true\n   *   },\n   *\n   *   // the storage engine for sqlite\n   *   // - default ':memory:'\n   *   storage: 'path/to/database.sqlite',\n   *\n   *   // disable inserting undefined values as NULL\n   *   // - default: false\n   *   omitNull: true,\n   *\n   *   // a flag for using a native library or not.\n   *   // in the case of 'pg' -- set this to true will allow SSL support\n   *   // - default: false\n   *   native: true,\n   *\n   *   // Specify options, which are used when sequelize.define is called.\n   *   // The following example:\n   *   //   define: { timestamps: false }\n   *   // is basically the same as:\n   *   //   Model.init(attributes, { timestamps: false });\n   *   //   sequelize.define(name, attributes, { timestamps: false });\n   *   // so defining the timestamps for each model will be not necessary\n   *   define: {\n   *     underscored: false,\n   *     freezeTableName: false,\n   *     charset: 'utf8',\n   *     dialectOptions: {\n   *       collate: 'utf8_general_ci'\n   *     },\n   *     timestamps: true\n   *   },\n   *\n   *   // similar for sync: you can define this to always force sync for models\n   *   sync: { force: true },\n   *\n   *   // pool configuration used to pool database connections\n   *   pool: {\n   *     max: 5,\n   *     idle: 30000,\n   *     acquire: 60000,\n   *   },\n   *\n   *   // isolation level of each transaction\n   *   // defaults to dialect default\n   *   isolationLevel: Transaction.ISOLATION_LEVELS.REPEATABLE_READ\n   * })\n   *\n   * @param {string}   [database] The name of the database\n   * @param {string}   [username=null] The username which is used to authenticate against the database.\n   * @param {string}   [password=null] The password which is used to authenticate against the database. Supports SQLCipher encryption for SQLite.\n   * @param {object}   [options={}] An object with options.\n   * @param {string}   [options.host='localhost'] The host of the relational database.\n   * @param {number}   [options.port=] The port of the relational database.\n   * @param {string}   [options.username=null] The username which is used to authenticate against the database.\n   * @param {string}   [options.password=null] The password which is used to authenticate against the database.\n   * @param {string}   [options.database=null] The name of the database\n   * @param {string}   [options.dialect] The dialect of the database you are connecting to. One of mysql, postgres, sqlite and mssql.\n   * @param {string}   [options.dialectModule=null] If specified, use this dialect library. For example, if you want to use pg.js instead of pg when connecting to a pg database, you should specify 'require(\"pg.js\")' here\n   * @param {string}   [options.dialectModulePath=null] If specified, load the dialect library from this path. For example, if you want to use pg.js instead of pg when connecting to a pg database, you should specify '/path/to/pg.js' here\n   * @param {object}   [options.dialectOptions] An object of additional options, which are passed directly to the connection library\n   * @param {string}   [options.storage] Only used by sqlite. Defaults to ':memory:'\n   * @param {string}   [options.protocol='tcp'] The protocol of the relational database.\n   * @param {object}   [options.define={}] Default options for model definitions. See {@link Model.init}.\n   * @param {object}   [options.query={}] Default options for sequelize.query\n   * @param {string}   [options.schema=null] A schema to use\n   * @param {object}   [options.set={}] Default options for sequelize.set\n   * @param {object}   [options.sync={}] Default options for sequelize.sync\n   * @param {string}   [options.timezone='+00:00'] The timezone used when converting a date from the database into a JavaScript date. The timezone is also used to SET TIMEZONE when connecting to the server, to ensure that the result of NOW, CURRENT_TIMESTAMP and other time related functions have in the right timezone. For best cross platform performance use the format +/-HH:MM. Will also accept string versions of timezones used by moment.js (e.g. 'America/Los_Angeles'); this is useful to capture daylight savings time changes.\n   * @param {string|boolean} [options.clientMinMessages='warning'] The PostgreSQL `client_min_messages` session parameter. Set to `false` to not override the database's default.\n   * @param {boolean}  [options.standardConformingStrings=true] The PostgreSQL `standard_conforming_strings` session parameter. Set to `false` to not set the option. WARNING: Setting this to false may expose vulnerabilities and is not recommended!\n   * @param {Function} [options.logging=console.log] A function that gets executed every time Sequelize would log something. Function may receive multiple parameters but only first one is printed by `console.log`. To print all values use `(...msg) => console.log(msg)`\n   * @param {boolean}  [options.benchmark=false] Pass query execution time in milliseconds as second argument to logging function (options.logging).\n   * @param {boolean}  [options.omitNull=false] A flag that defines if null values should be passed as values to CREATE/UPDATE SQL queries or not.\n   * @param {boolean}  [options.native=false] A flag that defines if native library shall be used or not. Currently only has an effect for postgres\n   * @param {boolean}  [options.replication=false] Use read / write replication. To enable replication, pass an object, with two properties, read and write. Write should be an object (a single server for handling writes), and read an array of object (several servers to handle reads). Each read/write server can have the following properties: `host`, `port`, `username`, `password`, `database`\n   * @param {object}   [options.pool] sequelize connection pool configuration\n   * @param {number}   [options.pool.max=5] Maximum number of connection in pool\n   * @param {number}   [options.pool.min=0] Minimum number of connection in pool\n   * @param {number}   [options.pool.idle=10000] The maximum time, in milliseconds, that a connection can be idle before being released.\n   * @param {number}   [options.pool.acquire=60000] The maximum time, in milliseconds, that pool will try to get connection before throwing error\n   * @param {number}   [options.pool.evict=1000] The time interval, in milliseconds, after which sequelize-pool will remove idle connections.\n   * @param {Function} [options.pool.validate] A function that validates a connection. Called with client. The default function checks that client is an object, and that its state is not disconnected\n   * @param {number}   [options.pool.maxUses=Infinity] The number of times a connection can be used before discarding it for a replacement, [`used for eventual cluster rebalancing`](https://github.com/sequelize/sequelize-pool).\n   * @param {boolean}  [options.quoteIdentifiers=true] Set to `false` to make table names and attributes case-insensitive on Postgres and skip double quoting of them.  WARNING: Setting this to false may expose vulnerabilities and is not recommended!\n   * @param {string}   [options.transactionType='DEFERRED'] Set the default transaction type. See `Sequelize.Transaction.TYPES` for possible options. Sqlite only.\n   * @param {string}   [options.isolationLevel] Set the default transaction isolation level. See `Sequelize.Transaction.ISOLATION_LEVELS` for possible options.\n   * @param {object}   [options.retry] Set of flags that control when a query is automatically retried. Accepts all options for [`retry-as-promised`](https://github.com/mickhansen/retry-as-promised).\n   * @param {Array}    [options.retry.match] Only retry a query if the error matches one of these strings.\n   * @param {number}   [options.retry.max] How many times a failing query is automatically retried.  Set to 0 to disable retrying on SQL_BUSY error.\n   * @param {boolean}  [options.typeValidation=false] Run built-in type validators on insert and update, and select with where clause, e.g. validate that arguments passed to integer fields are integer-like.\n   * @param {object}   [options.operatorsAliases] String based operator alias. Pass object to limit set of aliased operators.\n   * @param {object}   [options.hooks] An object of global hook functions that are called before and after certain lifecycle events. Global hooks will run after any model-specific hooks defined for the same event (See `Sequelize.Model.init()` for a list).  Additionally, `beforeConnect()`, `afterConnect()`, `beforeDisconnect()`, and `afterDisconnect()` hooks may be defined here.\n   * @param {boolean}  [options.minifyAliases=false] A flag that defines if aliases should be minified (mostly useful to avoid Postgres alias character limit of 64)\n   * @param {boolean}  [options.logQueryParameters=false] A flag that defines if show bind patameters in log.\n   */\n  constructor(database, username, password, options) {\n    let config;\n\n    if (arguments.length === 1 && typeof database === 'object') {\n      // new Sequelize({ ... options })\n      options = database;\n      config = _.pick(options, 'host', 'port', 'database', 'username', 'password');\n    } else if (arguments.length === 1 && typeof database === 'string' || arguments.length === 2 && typeof username === 'object') {\n      // new Sequelize(URI, { ... options })\n\n      config = {};\n      options = username || {};\n\n      const urlParts = url.parse(arguments[0], true);\n\n      options.dialect = urlParts.protocol.replace(/:$/, '');\n      options.host = urlParts.hostname;\n\n      if (options.dialect === 'sqlite' && urlParts.pathname && !urlParts.pathname.startsWith('/:memory')) {\n        const storagePath = path.join(options.host, urlParts.pathname);\n        options.storage = path.resolve(options.storage || storagePath);\n      }\n\n      if (urlParts.pathname) {\n        config.database = urlParts.pathname.replace(/^\\//, '');\n      }\n\n      if (urlParts.port) {\n        options.port = urlParts.port;\n      }\n\n      if (urlParts.auth) {\n        const authParts = urlParts.auth.split(':');\n\n        config.username = authParts[0];\n\n        if (authParts.length > 1)\n          config.password = authParts.slice(1).join(':');\n      }\n\n      if (urlParts.query) {\n        // Allow host query argument to override the url host.\n        // Enables specifying domain socket hosts which cannot be specified via the typical\n        // host part of a url.\n        if (urlParts.query.host) {\n          options.host = urlParts.query.host;\n        }\n\n        if (options.dialectOptions) {\n          Object.assign(options.dialectOptions, urlParts.query);\n        } else {\n          options.dialectOptions = urlParts.query;\n          if (urlParts.query.options) {\n            try {\n              const o = JSON.parse(urlParts.query.options);\n              options.dialectOptions.options = o;\n            } catch (e) {\n              // Nothing to do, string is not a valid JSON\n              // an thus does not need any further processing\n            }\n          }\n        }\n      }\n    } else {\n      // new Sequelize(database, username, password, { ... options })\n      options = options || {};\n      config = { database, username, password };\n    }\n\n    Sequelize.runHooks('beforeInit', config, options);\n\n    this.options = {\n      dialect: null,\n      dialectModule: null,\n      dialectModulePath: null,\n      host: 'localhost',\n      protocol: 'tcp',\n      define: {},\n      query: {},\n      sync: {},\n      timezone: '+00:00',\n      clientMinMessages: 'warning',\n      standardConformingStrings: true,\n      // eslint-disable-next-line no-console\n      logging: console.log,\n      omitNull: false,\n      native: false,\n      replication: false,\n      ssl: undefined,\n      pool: {},\n      quoteIdentifiers: true,\n      hooks: {},\n      retry: {\n        max: 5,\n        match: [\n          'SQLITE_BUSY: database is locked'\n        ]\n      },\n      transactionType: Transaction.TYPES.DEFERRED,\n      isolationLevel: null,\n      databaseVersion: 0,\n      typeValidation: false,\n      benchmark: false,\n      minifyAliases: false,\n      logQueryParameters: false,\n      ...options\n    };\n\n    if (!this.options.dialect) {\n      throw new Error('Dialect needs to be explicitly supplied as of v4.0.0');\n    }\n\n    if (this.options.dialect === 'postgresql') {\n      this.options.dialect = 'postgres';\n    }\n\n    if (this.options.dialect === 'sqlite' && this.options.timezone !== '+00:00') {\n      throw new Error('Setting a custom timezone is not supported by SQLite, dates are always returned as UTC. Please remove the custom timezone parameter.');\n    }\n\n    if (this.options.logging === true) {\n      deprecations.noTrueLogging();\n      // eslint-disable-next-line no-console\n      this.options.logging = console.log;\n    }\n\n    this._setupHooks(options.hooks);\n\n    this.config = {\n      database: config.database || this.options.database,\n      username: config.username || this.options.username,\n      password: config.password || this.options.password || null,\n      host: config.host || this.options.host,\n      port: config.port || this.options.port,\n      pool: this.options.pool,\n      protocol: this.options.protocol,\n      native: this.options.native,\n      ssl: this.options.ssl,\n      replication: this.options.replication,\n      dialectModule: this.options.dialectModule,\n      dialectModulePath: this.options.dialectModulePath,\n      keepDefaultTimezone: this.options.keepDefaultTimezone,\n      dialectOptions: this.options.dialectOptions\n    };\n\n    let Dialect;\n    // Requiring the dialect in a switch-case to keep the\n    // require calls static. (Browserify fix)\n    switch (this.getDialect()) {\n      case 'mariadb':\n        Dialect = require('./dialects/mariadb');\n        break;\n      case 'mssql':\n        Dialect = require('./dialects/mssql');\n        break;\n      case 'mysql':\n        Dialect = require('./dialects/mysql');\n        break;\n      case 'postgres':\n        Dialect = require('./dialects/postgres');\n        break;\n      case 'sqlite':\n        Dialect = require('./dialects/sqlite');\n        break;\n      default:\n        throw new Error(`The dialect ${this.getDialect()} is not supported. Supported dialects: mssql, mariadb, mysql, postgres, and sqlite.`);\n    }\n\n    this.dialect = new Dialect(this);\n    this.dialect.queryGenerator.typeValidation = options.typeValidation;\n\n    if (_.isPlainObject(this.options.operatorsAliases)) {\n      deprecations.noStringOperators();\n      this.dialect.queryGenerator.setOperatorsAliases(this.options.operatorsAliases);\n    } else if (typeof this.options.operatorsAliases === 'boolean') {\n      deprecations.noBoolOperatorAliases();\n    }\n\n    this.queryInterface = this.dialect.queryInterface;\n\n    /**\n     * Models are stored here under the name given to `sequelize.define`\n     */\n    this.models = {};\n    this.modelManager = new ModelManager(this);\n    this.connectionManager = this.dialect.connectionManager;\n\n    Sequelize.runHooks('afterInit', this);\n  }\n\n  /**\n   * Refresh data types and parsers.\n   *\n   * @private\n   */\n  refreshTypes() {\n    this.connectionManager.refreshTypeParser(DataTypes);\n  }\n\n  /**\n   * Returns the specified dialect.\n   *\n   * @returns {string} The specified dialect.\n   */\n  getDialect() {\n    return this.options.dialect;\n  }\n\n  /**\n   * Returns the database name.\n   *\n   * @returns {string} The database name.\n   */\n  getDatabaseName() {\n    return this.config.database;\n  }\n\n  /**\n   * Returns an instance of QueryInterface.\n   *\n   * @returns {QueryInterface} An instance (singleton) of QueryInterface.\n   */\n  getQueryInterface() {\n    return this.queryInterface;\n  }\n\n  /**\n   * Define a new model, representing a table in the database.\n   *\n   * The table columns are defined by the object that is given as the second argument. Each key of the object represents a column\n   *\n   * @param {string} modelName The name of the model. The model will be stored in `sequelize.models` under this name\n   * @param {object} attributes An object, where each attribute is a column of the table. See {@link Model.init}\n   * @param {object} [options] These options are merged with the default define options provided to the Sequelize constructor and passed to Model.init()\n   *\n   * @see\n   * {@link Model.init} for a more comprehensive specification of the `options` and `attributes` objects.\n   * @see\n   * <a href=\"/master/manual/model-basics.html\">Model Basics</a> guide\n   *\n   * @returns {Model} Newly defined model\n   *\n   * @example\n   * sequelize.define('modelName', {\n   *   columnA: {\n   *       type: Sequelize.BOOLEAN,\n   *       validate: {\n   *         is: [\"[a-z]\",'i'],        // will only allow letters\n   *         max: 23,                  // only allow values <= 23\n   *         isIn: {\n   *           args: [['en', 'zh']],\n   *           msg: \"Must be English or Chinese\"\n   *         }\n   *       },\n   *       field: 'column_a'\n   *   },\n   *   columnB: Sequelize.STRING,\n   *   columnC: 'MY VERY OWN COLUMN TYPE'\n   * });\n   *\n   * sequelize.models.modelName // The model will now be available in models under the name given to define\n   */\n  define(modelName, attributes, options = {}) {\n    options.modelName = modelName;\n    options.sequelize = this;\n\n    const model = class extends Model {};\n\n    model.init(attributes, options);\n\n    return model;\n  }\n\n  /**\n   * Fetch a Model which is already defined\n   *\n   * @param {string} modelName The name of a model defined with Sequelize.define\n   *\n   * @throws Will throw an error if the model is not defined (that is, if sequelize#isDefined returns false)\n   * @returns {Model} Specified model\n   */\n  model(modelName) {\n    if (!this.isDefined(modelName)) {\n      throw new Error(`${modelName} has not been defined`);\n    }\n\n    return this.modelManager.getModel(modelName);\n  }\n\n  /**\n   * Checks whether a model with the given name is defined\n   *\n   * @param {string} modelName The name of a model defined with Sequelize.define\n   *\n   * @returns {boolean} Returns true if model is already defined, otherwise false\n   */\n  isDefined(modelName) {\n    return !!this.modelManager.models.find(model => model.name === modelName);\n  }\n\n  /**\n   * Execute a query on the DB, optionally bypassing all the Sequelize goodness.\n   *\n   * By default, the function will return two arguments: an array of results, and a metadata object, containing number of affected rows etc.\n   *\n   * If you are running a type of query where you don't need the metadata, for example a `SELECT` query, you can pass in a query type to make sequelize format the results:\n   *\n   * ```js\n   * const [results, metadata] = await sequelize.query('SELECT...'); // Raw query - use array destructuring\n   *\n   * const results = await sequelize.query('SELECT...', { type: sequelize.QueryTypes.SELECT }); // SELECT query - no destructuring\n   * ```\n   *\n   * @param {string}          sql\n   * @param {object}          [options={}] Query options.\n   * @param {boolean}         [options.raw] If true, sequelize will not try to format the results of the query, or build an instance of a model from the result\n   * @param {Transaction}     [options.transaction=null] The transaction that the query should be executed under\n   * @param {QueryTypes}      [options.type='RAW'] The type of query you are executing. The query type affects how results are formatted before they are passed back. The type is a string, but `Sequelize.QueryTypes` is provided as convenience shortcuts.\n   * @param {boolean}         [options.nest=false] If true, transforms objects with `.` separated property names into nested objects using [dottie.js](https://github.com/mickhansen/dottie.js). For example { 'user.username': 'john' } becomes { user: { username: 'john' }}. When `nest` is true, the query type is assumed to be `'SELECT'`, unless otherwise specified\n   * @param {boolean}         [options.plain=false] Sets the query type to `SELECT` and return a single row\n   * @param {object|Array}    [options.replacements] Either an object of named parameter replacements in the format `:param` or an array of unnamed replacements to replace `?` in your SQL.\n   * @param {object|Array}    [options.bind] Either an object of named bind parameter in the format `_param` or an array of unnamed bind parameter to replace `$1, $2, ...` in your SQL.\n   * @param {boolean}         [options.useMaster=false] Force the query to use the write pool, regardless of the query type.\n   * @param {Function}        [options.logging=false] A function that gets executed while running the query to log the sql.\n   * @param {Model}           [options.instance] A sequelize model instance whose Model is to be used to build the query result\n   * @param {typeof Model}    [options.model] A sequelize model used to build the returned model instances\n   * @param {object}          [options.retry] Set of flags that control when a query is automatically retried. Accepts all options for [`retry-as-promised`](https://github.com/mickhansen/retry-as-promised).\n   * @param {Array}           [options.retry.match] Only retry a query if the error matches one of these strings.\n   * @param {Integer}         [options.retry.max] How many times a failing query is automatically retried.\n   * @param {string}          [options.searchPath=DEFAULT] An optional parameter to specify the schema search_path (Postgres only)\n   * @param {boolean}         [options.supportsSearchPath] If false do not prepend the query with the search_path (Postgres only)\n   * @param {boolean}         [options.mapToModel=false] Map returned fields to model's fields if `options.model` or `options.instance` is present. Mapping will occur before building the model instance.\n   * @param {object}          [options.fieldMap] Map returned fields to arbitrary names for `SELECT` query type.\n   *\n   * @returns {Promise}\n   *\n   * @see {@link Model.build} for more information about instance option.\n   */\n\n  async query(sql, options) {\n    options = { ...this.options.query, ...options };\n\n    if (options.instance && !options.model) {\n      options.model = options.instance.constructor;\n    }\n\n    if (!options.instance && !options.model) {\n      options.raw = true;\n    }\n\n    // map raw fields to model attributes\n    if (options.mapToModel) {\n      options.fieldMap = _.get(options, 'model.fieldAttributeMap', {});\n    }\n\n    options = _.defaults(options, {\n      // eslint-disable-next-line no-console\n      logging: Object.prototype.hasOwnProperty.call(this.options, 'logging') ? this.options.logging : console.log,\n      searchPath: Object.prototype.hasOwnProperty.call(this.options, 'searchPath') ? this.options.searchPath : 'DEFAULT'\n    });\n\n    if (!options.type) {\n      if (options.model || options.nest || options.plain) {\n        options.type = QueryTypes.SELECT;\n      } else {\n        options.type = QueryTypes.RAW;\n      }\n    }\n\n    //if dialect doesn't support search_path or dialect option\n    //to prepend searchPath is not true delete the searchPath option\n    if (\n      !this.dialect.supports.searchPath ||\n      !this.options.dialectOptions ||\n      !this.options.dialectOptions.prependSearchPath ||\n      options.supportsSearchPath === false\n    ) {\n      delete options.searchPath;\n    } else if (!options.searchPath) {\n      //if user wants to always prepend searchPath (dialectOptions.preprendSearchPath = true)\n      //then set to DEFAULT if none is provided\n      options.searchPath = 'DEFAULT';\n    }\n\n    if (typeof sql === 'object') {\n      if (sql.values !== undefined) {\n        if (options.replacements !== undefined) {\n          throw new Error('Both `sql.values` and `options.replacements` cannot be set at the same time');\n        }\n        options.replacements = sql.values;\n      }\n\n      if (sql.bind !== undefined) {\n        if (options.bind !== undefined) {\n          throw new Error('Both `sql.bind` and `options.bind` cannot be set at the same time');\n        }\n        options.bind = sql.bind;\n      }\n\n      if (sql.query !== undefined) {\n        sql = sql.query;\n      }\n    }\n\n    sql = sql.trim();\n\n    if (options.replacements && options.bind) {\n      throw new Error('Both `replacements` and `bind` cannot be set at the same time');\n    }\n\n    if (options.replacements) {\n      if (Array.isArray(options.replacements)) {\n        sql = Utils.format([sql].concat(options.replacements), this.options.dialect);\n      } else {\n        sql = Utils.formatNamedParameters(sql, options.replacements, this.options.dialect);\n      }\n    }\n\n    let bindParameters;\n\n    if (options.bind) {\n      [sql, bindParameters] = this.dialect.Query.formatBindParameters(sql, options.bind, this.options.dialect);\n    }\n\n    const checkTransaction = () => {\n      if (options.transaction && options.transaction.finished && !options.completesTransaction) {\n        const error = new Error(`${options.transaction.finished} has been called on this transaction(${options.transaction.id}), you can no longer use it. (The rejected query is attached as the 'sql' property of this error)`);\n        error.sql = sql;\n        throw error;\n      }\n    };\n\n    const retryOptions = { ...this.options.retry, ...options.retry };\n\n    return retry(async () => {\n      if (options.transaction === undefined && Sequelize._cls) {\n        options.transaction = Sequelize._cls.get('transaction');\n      }\n\n      checkTransaction();\n\n      const connection = await (options.transaction ? options.transaction.connection : this.connectionManager.getConnection(options));\n      const query = new this.dialect.Query(connection, this, options);\n\n      try {\n        await this.runHooks('beforeQuery', options, query);\n        checkTransaction();\n        return await query.run(sql, bindParameters);\n      } finally {\n        await this.runHooks('afterQuery', options, query);\n        if (!options.transaction) {\n          await this.connectionManager.releaseConnection(connection);\n        }\n      }\n    }, retryOptions);\n  }\n\n  /**\n   * Execute a query which would set an environment or user variable. The variables are set per connection, so this function needs a transaction.\n   * Only works for MySQL.\n   *\n   * @param {object}        variables Object with multiple variables.\n   * @param {object}        [options] query options.\n   * @param {Transaction}   [options.transaction] The transaction that the query should be executed under\n   *\n   * @memberof Sequelize\n   *\n   * @returns {Promise}\n   */\n  async set(variables, options) {\n\n    // Prepare options\n    options = { ...this.options.set, ...typeof options === 'object' && options };\n\n    if (this.options.dialect !== 'mysql') {\n      throw new Error('sequelize.set is only supported for mysql');\n    }\n    if (!options.transaction || !(options.transaction instanceof Transaction) ) {\n      throw new TypeError('options.transaction is required');\n    }\n\n    // Override some options, since this isn't a SELECT\n    options.raw = true;\n    options.plain = true;\n    options.type = 'SET';\n\n    // Generate SQL Query\n    const query =\n      `SET ${\n        _.map(variables, (v, k) => `@${k} := ${typeof v === 'string' ? `\"${v}\"` : v}`).join(', ')}`;\n\n    return await this.query(query, options);\n  }\n\n  /**\n   * Escape value.\n   *\n   * @param {string} value string value to escape\n   *\n   * @returns {string}\n   */\n  escape(value) {\n    return this.dialect.queryGenerator.escape(value);\n  }\n\n  /**\n   * Create a new database schema.\n   *\n   * **Note:** this is a schema in the [postgres sense of the word](http://www.postgresql.org/docs/9.1/static/ddl-schemas.html),\n   * not a database table. In mysql and sqlite, this command will do nothing.\n   *\n   * @see\n   * {@link Model.schema}\n   *\n   * @param {string} schema Name of the schema\n   * @param {object} [options={}] query options\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n  async createSchema(schema, options) {\n    return await this.getQueryInterface().createSchema(schema, options);\n  }\n\n  /**\n   * Show all defined schemas\n   *\n   * **Note:** this is a schema in the [postgres sense of the word](http://www.postgresql.org/docs/9.1/static/ddl-schemas.html),\n   * not a database table. In mysql and sqlite, this will show all tables.\n   *\n   * @param {object} [options={}] query options\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n  async showAllSchemas(options) {\n    return await this.getQueryInterface().showAllSchemas(options);\n  }\n\n  /**\n   * Drop a single schema\n   *\n   * **Note:** this is a schema in the [postgres sense of the word](http://www.postgresql.org/docs/9.1/static/ddl-schemas.html),\n   * not a database table. In mysql and sqlite, this drop a table matching the schema name\n   *\n   * @param {string} schema Name of the schema\n   * @param {object} [options={}] query options\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n  async dropSchema(schema, options) {\n    return await this.getQueryInterface().dropSchema(schema, options);\n  }\n\n  /**\n   * Drop all schemas.\n   *\n   * **Note:** this is a schema in the [postgres sense of the word](http://www.postgresql.org/docs/9.1/static/ddl-schemas.html),\n   * not a database table. In mysql and sqlite, this is the equivalent of drop all tables.\n   *\n   * @param {object} [options={}] query options\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n  async dropAllSchemas(options) {\n    return await this.getQueryInterface().dropAllSchemas(options);\n  }\n\n  /**\n   * Sync all defined models to the DB.\n   *\n   * @param {object} [options={}] sync options\n   * @param {boolean} [options.force=false] If force is true, each Model will run `DROP TABLE IF EXISTS`, before it tries to create its own table\n   * @param {RegExp} [options.match] Match a regex against the database name before syncing, a safety check for cases where force: true is used in tests but not live code\n   * @param {boolean|Function} [options.logging=console.log] A function that logs sql queries, or false for no logging\n   * @param {string} [options.schema='public'] The schema that the tables should be created in. This can be overridden for each table in sequelize.define\n   * @param {string} [options.searchPath=DEFAULT] An optional parameter to specify the schema search_path (Postgres only)\n   * @param {boolean} [options.hooks=true] If hooks is true then beforeSync, afterSync, beforeBulkSync, afterBulkSync hooks will be called\n   * @param {boolean|object} [options.alter=false] Alters tables to fit models. Provide an object for additional configuration. Not recommended for production use. If not further configured deletes data in columns that were removed or had their type changed in the model.\n   * @param {boolean} [options.alter.drop=true] Prevents any drop statements while altering a table when set to `false`\n   *\n   * @returns {Promise}\n   */\n  async sync(options) {\n    options = {\n      ...this.options,\n      ...this.options.sync,\n      ...options,\n      hooks: options ? options.hooks !== false : true\n    };\n\n    if (options.match) {\n      if (!options.match.test(this.config.database)) {\n        throw new Error(`Database \"${this.config.database}\" does not match sync match parameter \"${options.match}\"`);\n      }\n    }\n\n    if (options.hooks) {\n      await this.runHooks('beforeBulkSync', options);\n    }\n    if (options.force) {\n      await this.drop(options);\n    }\n    const models = [];\n\n    // Topologically sort by foreign key constraints to give us an appropriate\n    // creation order\n    this.modelManager.forEachModel(model => {\n      if (model) {\n        models.push(model);\n      } else {\n        // DB should throw an SQL error if referencing non-existent table\n      }\n    });\n\n    // no models defined, just authenticate\n    if (!models.length) {\n      await this.authenticate(options);\n    } else {\n      for (const model of models) await model.sync(options);\n    }\n    if (options.hooks) {\n      await this.runHooks('afterBulkSync', options);\n    }\n    return this;\n  }\n\n  /**\n   * Truncate all tables defined through the sequelize models.\n   * This is done by calling `Model.truncate()` on each model.\n   *\n   * @param {object} [options] The options passed to Model.destroy in addition to truncate\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   * @returns {Promise}\n   *\n   * @see\n   * {@link Model.truncate} for more information\n   */\n  async truncate(options) {\n    const models = [];\n\n    this.modelManager.forEachModel(model => {\n      if (model) {\n        models.push(model);\n      }\n    }, { reverse: false });\n\n    if (options && options.cascade) {\n      for (const model of models) await model.truncate(options);\n    } else {\n      await Promise.all(models.map(model => model.truncate(options)));\n    }\n  }\n\n  /**\n   * Drop all tables defined through this sequelize instance.\n   * This is done by calling Model.drop on each model.\n   *\n   * @see\n   * {@link Model.drop} for options\n   *\n   * @param {object} [options] The options passed to each call to Model.drop\n   * @param {boolean|Function} [options.logging] A function that logs sql queries, or false for no logging\n   *\n   * @returns {Promise}\n   */\n  async drop(options) {\n    const models = [];\n\n    this.modelManager.forEachModel(model => {\n      if (model) {\n        models.push(model);\n      }\n    }, { reverse: false });\n\n    for (const model of models) await model.drop(options);\n  }\n\n  /**\n   * Test the connection by trying to authenticate. It runs `SELECT 1+1 AS result` query.\n   *\n   * @param {object} [options={}] query options\n   *\n   * @returns {Promise}\n   */\n  async authenticate(options) {\n    options = {\n      raw: true,\n      plain: true,\n      type: QueryTypes.SELECT,\n      ...options\n    };\n\n    await this.query('SELECT 1+1 AS result', options);\n\n    return;\n  }\n\n  async databaseVersion(options) {\n    return await this.getQueryInterface().databaseVersion(options);\n  }\n\n  /**\n   * Get the fn for random based on the dialect\n   *\n   * @returns {Sequelize.fn}\n   */\n  random() {\n    const dia = this.getDialect();\n    if (dia === 'postgres' || dia === 'sqlite') {\n      return this.fn('RANDOM');\n    }\n    return this.fn('RAND');\n  }\n\n  /**\n   * Creates an object representing a database function. This can be used in search queries, both in where and order parts, and as default values in column definitions.\n   * If you want to refer to columns in your function, you should use `sequelize.col`, so that the columns are properly interpreted as columns and not a strings.\n   *\n   * @see\n   * {@link Model.findAll}\n   * @see\n   * {@link Sequelize.define}\n   * @see\n   * {@link Sequelize.col}\n   *\n   * @param {string} fn The function you want to call\n   * @param {any} args All further arguments will be passed as arguments to the function\n   *\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   * @returns {Sequelize.fn}\n   *\n   * @example <caption>Convert a user's username to upper case</caption>\n   * instance.update({\n   *   username: sequelize.fn('upper', sequelize.col('username'))\n   * });\n   */\n  static fn(fn, ...args) {\n    return new Utils.Fn(fn, args);\n  }\n\n  /**\n   * Creates an object which represents a column in the DB, this allows referencing another column in your query. This is often useful in conjunction with `sequelize.fn`, since raw string arguments to fn will be escaped.\n   *\n   * @see\n   * {@link Sequelize#fn}\n   *\n   * @param {string} col The name of the column\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.col}\n   */\n  static col(col) {\n    return new Utils.Col(col);\n  }\n\n  /**\n   * Creates an object representing a call to the cast function.\n   *\n   * @param {any} val The value to cast\n   * @param {string} type The type to cast it to\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.cast}\n   */\n  static cast(val, type) {\n    return new Utils.Cast(val, type);\n  }\n\n  /**\n   * Creates an object representing a literal, i.e. something that will not be escaped.\n   *\n   * @param {any} val literal value\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.literal}\n   */\n  static literal(val) {\n    return new Utils.Literal(val);\n  }\n\n  /**\n   * An AND query\n   *\n   * @see\n   * {@link Model.findAll}\n   *\n   * @param {...string|object} args Each argument will be joined by AND\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.and}\n   */\n  static and(...args) {\n    return { [Op.and]: args };\n  }\n\n  /**\n   * An OR query\n   *\n   * @see\n   * {@link Model.findAll}\n   *\n   * @param {...string|object} args Each argument will be joined by OR\n   * @since v2.0.0-dev3\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.or}\n   */\n  static or(...args) {\n    return { [Op.or]: args };\n  }\n\n  /**\n   * Creates an object representing nested where conditions for postgres/sqlite/mysql json data-type.\n   *\n   * @see\n   * {@link Model.findAll}\n   *\n   * @param {string|object} conditionsOrPath A hash containing strings/numbers or other nested hash, a string using dot notation or a string using postgres/sqlite/mysql json syntax.\n   * @param {string|number|boolean} [value] An optional value to compare against. Produces a string of the form \"<json path> = '<value>'\".\n   * @memberof Sequelize\n   *\n   * @returns {Sequelize.json}\n   */\n  static json(conditionsOrPath, value) {\n    return new Utils.Json(conditionsOrPath, value);\n  }\n\n  /**\n   * A way of specifying attr = condition.\n   *\n   * The attr can either be an object taken from `Model.rawAttributes` (for example `Model.rawAttributes.id` or `Model.rawAttributes.name`). The\n   * attribute should be defined in your model definition. The attribute can also be an object from one of the sequelize utility functions (`sequelize.fn`, `sequelize.col` etc.)\n   *\n   * For string attributes, use the regular `{ where: { attr: something }}` syntax. If you don't want your string to be escaped, use `sequelize.literal`.\n   *\n   * @see\n   * {@link Model.findAll}\n   *\n   * @param {object} attr The attribute, which can be either an attribute object from `Model.rawAttributes` or a sequelize object, for example an instance of `sequelize.fn`. For simple string attributes, use the POJO syntax\n   * @param {symbol} [comparator='Op.eq'] operator\n   * @param {string|object} logic The condition. Can be both a simply type, or a further condition (`or`, `and`, `.literal` etc.)\n   * @since v2.0.0-dev3\n   */\n  static where(attr, comparator, logic) {\n    return new Utils.Where(attr, comparator, logic);\n  }\n\n  /**\n   * Start a transaction. When using transactions, you should pass the transaction in the options argument in order for the query to happen under that transaction @see {@link Transaction}\n   *\n   * If you have [CLS](https://github.com/Jeff-Lewis/cls-hooked) enabled, the transaction will automatically be passed to any query that runs within the callback\n   *\n   * @example\n   *\n   * try {\n   *   const transaction = await sequelize.transaction();\n   *   const user = await User.findOne(..., { transaction });\n   *   await user.update(..., { transaction });\n   *   await transaction.commit();\n   * } catch {\n   *   await transaction.rollback()\n   * }\n   *\n   * @example <caption>A syntax for automatically committing or rolling back based on the promise chain resolution is also supported</caption>\n   *\n   * try {\n   *   await sequelize.transaction(transaction => { // Note that we pass a callback rather than awaiting the call with no arguments\n   *     const user = await User.findOne(..., {transaction});\n   *     await user.update(..., {transaction});\n   *   });\n   *   // Committed\n   * } catch(err) {\n   *   // Rolled back\n   *   console.error(err);\n   * }\n   * @example <caption>To enable CLS, add it do your project, create a namespace and set it on the sequelize constructor:</caption>\n   *\n   * const cls = require('cls-hooked');\n   * const namespace = cls.createNamespace('....');\n   * const Sequelize = require('sequelize');\n   * Sequelize.useCLS(namespace);\n   *\n   * // Note, that CLS is enabled for all sequelize instances, and all instances will share the same namespace\n   *\n   * @param {object}   [options] Transaction options\n   * @param {string}   [options.type='DEFERRED'] See `Sequelize.Transaction.TYPES` for possible options. Sqlite only.\n   * @param {string}   [options.isolationLevel] See `Sequelize.Transaction.ISOLATION_LEVELS` for possible options\n   * @param {string}   [options.deferrable] Sets the constraints to be deferred or immediately checked. See `Sequelize.Deferrable`. PostgreSQL Only\n   * @param {Function} [options.logging=false] A function that gets executed while running the query to log the sql.\n   * @param {Function} [autoCallback] The callback is called with the transaction object, and should return a promise. If the promise is resolved, the transaction commits; if the promise rejects, the transaction rolls back\n   *\n   * @returns {Promise}\n   */\n  async transaction(options, autoCallback) {\n    if (typeof options === 'function') {\n      autoCallback = options;\n      options = undefined;\n    }\n\n    const transaction = new Transaction(this, options);\n\n    if (!autoCallback) {\n      await transaction.prepareEnvironment(false);\n      return transaction;\n    }\n\n    // autoCallback provided\n    return Sequelize._clsRun(async () => {\n      try {\n        await transaction.prepareEnvironment();\n        const result = await autoCallback(transaction);\n        await transaction.commit();\n        return await result;\n      } catch (err) {\n        if (!transaction.finished) {\n          try {\n            await transaction.rollback();\n          } catch (err0) {\n            // ignore\n          }\n        }\n        throw err;\n      }\n    });\n  }\n\n  /**\n   * Use CLS with Sequelize.\n   * CLS namespace provided is stored as `Sequelize._cls`\n   *\n   * @param {object} ns CLS namespace\n   * @returns {object} Sequelize constructor\n   */\n  static useCLS(ns) {\n    // check `ns` is valid CLS namespace\n    if (!ns || typeof ns !== 'object' || typeof ns.bind !== 'function' || typeof ns.run !== 'function') throw new Error('Must provide CLS namespace');\n\n    // save namespace as `Sequelize._cls`\n    this._cls = ns;\n\n    // return Sequelize for chaining\n    return this;\n  }\n\n  /**\n   * Run function in CLS context.\n   * If no CLS context in use, just runs the function normally\n   *\n   * @private\n   * @param {Function} fn Function to run\n   * @returns {*} Return value of function\n   */\n  static _clsRun(fn) {\n    const ns = Sequelize._cls;\n    if (!ns) return fn();\n\n    let res;\n    ns.run(context => res = fn(context));\n    return res;\n  }\n\n  log(...args) {\n    let options;\n\n    const last = _.last(args);\n\n    if (last && _.isPlainObject(last) && Object.prototype.hasOwnProperty.call(last, 'logging')) {\n      options = last;\n\n      // remove options from set of logged arguments if options.logging is equal to console.log\n      // eslint-disable-next-line no-console\n      if (options.logging === console.log) {\n        args.splice(args.length - 1, 1);\n      }\n    } else {\n      options = this.options;\n    }\n\n    if (options.logging) {\n      if (options.logging === true) {\n        deprecations.noTrueLogging();\n        // eslint-disable-next-line no-console\n        options.logging = console.log;\n      }\n\n      // second argument is sql-timings, when benchmarking option enabled\n      // eslint-disable-next-line no-console\n      if ((this.options.benchmark || options.benchmark) && options.logging === console.log) {\n        args = [`${args[0]} Elapsed time: ${args[1]}ms`];\n      }\n\n      options.logging(...args);\n    }\n  }\n\n  /**\n   * Close all connections used by this sequelize instance, and free all references so the instance can be garbage collected.\n   *\n   * Normally this is done on process exit, so you only need to call this method if you are creating multiple instances, and want\n   * to garbage collect some of them.\n   *\n   * @returns {Promise}\n   */\n  close() {\n    return this.connectionManager.close();\n  }\n\n  normalizeDataType(Type) {\n    let type = typeof Type === 'function' ? new Type() : Type;\n    const dialectTypes = this.dialect.DataTypes || {};\n\n    if (dialectTypes[type.key]) {\n      type = dialectTypes[type.key].extend(type);\n    }\n\n    if (type instanceof DataTypes.ARRAY) {\n      if (!type.type) {\n        throw new Error('ARRAY is missing type definition for its values.');\n      }\n      if (dialectTypes[type.type.key]) {\n        type.type = dialectTypes[type.type.key].extend(type.type);\n      }\n    }\n\n    return type;\n  }\n\n  normalizeAttribute(attribute) {\n    if (!_.isPlainObject(attribute)) {\n      attribute = { type: attribute };\n    }\n\n    if (!attribute.type) return attribute;\n\n    attribute.type = this.normalizeDataType(attribute.type);\n\n    if (Object.prototype.hasOwnProperty.call(attribute, 'defaultValue')) {\n      if (typeof attribute.defaultValue === 'function' && (\n        attribute.defaultValue === DataTypes.NOW ||\n          attribute.defaultValue === DataTypes.UUIDV1 ||\n          attribute.defaultValue === DataTypes.UUIDV4\n      )) {\n        attribute.defaultValue = new attribute.defaultValue();\n      }\n    }\n\n    if (attribute.type instanceof DataTypes.ENUM) {\n      // The ENUM is a special case where the type is an object containing the values\n      if (attribute.values) {\n        attribute.type.values = attribute.type.options.values = attribute.values;\n      } else {\n        attribute.values = attribute.type.values;\n      }\n\n      if (!attribute.values.length) {\n        throw new Error('Values for ENUM have not been defined.');\n      }\n    }\n\n    return attribute;\n  }\n}\n\n// Aliases\nSequelize.prototype.fn = Sequelize.fn;\nSequelize.prototype.col = Sequelize.col;\nSequelize.prototype.cast = Sequelize.cast;\nSequelize.prototype.literal = Sequelize.literal;\nSequelize.prototype.and = Sequelize.and;\nSequelize.prototype.or = Sequelize.or;\nSequelize.prototype.json = Sequelize.json;\nSequelize.prototype.where = Sequelize.where;\nSequelize.prototype.validate = Sequelize.prototype.authenticate;\n\n/**\n * Sequelize version number.\n */\nSequelize.version = require('../package.json').version;\n\nSequelize.options = { hooks: {} };\n\n/**\n * @private\n */\nSequelize.Utils = Utils;\n\n/**\n * Operators symbols to be used for querying data\n *\n * @see  {@link Operators}\n */\nSequelize.Op = Op;\n\n/**\n * Available table hints to be used for querying data in mssql for table hints\n *\n * @see {@link TableHints}\n */\nSequelize.TableHints = TableHints;\n\n/**\n * Available index hints to be used for querying data in mysql for index hints\n *\n * @see {@link IndexHints}\n */\nSequelize.IndexHints = IndexHints;\n\n/**\n * A reference to the sequelize transaction class. Use this to access isolationLevels and types when creating a transaction\n *\n * @see {@link Transaction}\n * @see {@link Sequelize.transaction}\n */\nSequelize.Transaction = Transaction;\n\n/**\n * A reference to Sequelize constructor from sequelize. Useful for accessing DataTypes, Errors etc.\n *\n * @see {@link Sequelize}\n */\nSequelize.prototype.Sequelize = Sequelize;\n\n/**\n * Available query types for use with `sequelize.query`\n *\n * @see {@link QueryTypes}\n */\nSequelize.prototype.QueryTypes = Sequelize.QueryTypes = QueryTypes;\n\n/**\n * Exposes the validator.js object, so you can extend it with custom validation functions. The validator is exposed both on the instance, and on the constructor.\n *\n * @see https://github.com/chriso/validator.js\n */\nSequelize.prototype.Validator = Sequelize.Validator = Validator;\n\nSequelize.Model = Model;\n\nSequelize.DataTypes = DataTypes;\nfor (const dataType in DataTypes) {\n  Sequelize[dataType] = DataTypes[dataType];\n}\n\n/**\n * A reference to the deferrable collection. Use this to access the different deferrable options.\n *\n * @see {@link Transaction.Deferrable}\n * @see {@link Sequelize#transaction}\n */\nSequelize.Deferrable = Deferrable;\n\n/**\n * A reference to the sequelize association class.\n *\n * @see {@link Association}\n */\nSequelize.prototype.Association = Sequelize.Association = Association;\n\n/**\n * Provide alternative version of `inflection` module to be used by `Utils.pluralize` etc.\n *\n * @param {object} _inflection - `inflection` module\n */\nSequelize.useInflection = Utils.useInflection;\n\n/**\n * Allow hooks to be defined on Sequelize + on sequelize instance as universal hooks to run on all models\n * and on Sequelize/sequelize methods e.g. Sequelize(), Sequelize#define()\n */\nHooks.applyTo(Sequelize);\nHooks.applyTo(Sequelize.prototype);\n\n/**\n * Expose various errors available\n */\n\n// expose alias to BaseError\nSequelize.Error = sequelizeErrors.BaseError;\n\nfor (const error of Object.keys(sequelizeErrors)) {\n  Sequelize[error] = sequelizeErrors[error];\n}\n\nmodule.exports = Sequelize;\nmodule.exports.Sequelize = Sequelize;\nmodule.exports.default = Sequelize;\n"]},"metadata":{},"sourceType":"script"}